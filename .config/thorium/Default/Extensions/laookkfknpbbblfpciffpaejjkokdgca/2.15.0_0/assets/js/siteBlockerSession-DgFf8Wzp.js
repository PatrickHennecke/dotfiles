import{d as e}from"./ResizeSensor-CXS_pGRc.js";import{e as t,s,F as o,w as i,u as r}from"./dashboard-CF_jRhAY.js";import{u as a,a as n}from"./siteBlockerGroups-1V1XRNi6.js";import{S as c,a as p,b as d}from"./constants-D-OQQ8lR.js";import{p as l,c as g}from"./promisifiedChrome-CheD9WtZ.js";import{g as u}from"./focusModeHelpers-Cqkll3ju.js";import{c as j}from"./reactiveCustomization-CrL2eTrh.js";import{useFocusModeDashViewStateStore as w}from"./focusModeViewState-Sf_PQc_2.js";import"./environmentVariables-Cy83xda0.js";import"./main--IJuvtTE.js";import"./localStorage-B4mFdj8F.js";import"./preload-helper-D7CfCCEq.js";import"./Logger-Dqn8sDPg.js";import"./migrateLegacyUserMessageHandler-CU6TUnqH.js";import"./timestampDb-sTUCijT1.js";import"./compareObjects-BF7sSNEf.js";import"./string-KTo4Qfpe.js";import"./VueBase-CjPGMLuv.js";import"./index-CJJH83pl.js";import"./ViewState-CkTFc_ep.js";import"./siteBlockerViewState-BRcSSYc9.js";const v=new t(c,!1),S=new t(p,""),h=e("siteBlockerSession",{state:()=>({active:v.currentValue}),getters:{urls:()=>[...a().items.reduce(((e,t)=>t.enabled?(n().getWebsitesByGroup(t).filter((e=>e.enabled)).forEach((t=>e.add(t.hostWithWildcard))),e):e),new Set([]))].join(" "),enabledAndFocusModeActive:()=>j.siteBlockerEnabled&&s.currentValue&&u().apps.siteBlocker.enabled&&w().activeViewId===o.Focusing.toString()},actions:{async toggleActive(e){const t=e??!this.active;this.active===t||t&&!(await this.ensurePermissions())||(this.active=t)},async ensurePermissions(){const e=async()=>{const e=await g().scripting.getRegisteredContentScripts();return await new Promise((t=>{g().scripting[e.length?"updateContentScripts":"registerContentScripts"]([{id:"site-blocker",js:["/content-scripts/siteBlocker.js"],matches:["*://*/*"],runAt:"document_start"}],(()=>t(!0)))}))},t=d;return await l.permissions.contains(t)?await e():new Promise((s=>{m.cmd("modal.open","PERMISSION_REQUEST",{widgetName:"Site Blocker",permissionExplanation:"To block sites while focusing",permissions:t,resolve:async t=>{if(!t)return s(!1);await e(),s(!0)}})}))}}});(async()=>{const e=h(),t=a(),s=n();v.switchOverToWatchedStoreItem((()=>e.active));const o=()=>{var t;e.toggleActive(!(null==(t=localStorage.getItem("pomodoro-started"))?void 0:t.startsWith("rest")))},c=()=>{e.toggleActive(!1)},p=()=>e.enabledAndFocusModeActive&&u().apps.pomodoro.enabled;m.on("pomodoro:started",(()=>{p()&&o()})),m.on("pomodoro:stopped",(()=>{p()&&c()})),i([()=>e.enabledAndFocusModeActive,()=>u().apps.pomodoro.enabled],(([t,s])=>{if(t&&s){"true"===localStorage.getItem("pomodoro-running")?o():c()}else t&&!s&&e.toggleActive(!0)})),await r((()=>t.loaded)).toBe(!0),await r((()=>s.loaded)).toBe(!0),S.switchOverToWatchedStoreItem((()=>e.urls))})();export{h as default};