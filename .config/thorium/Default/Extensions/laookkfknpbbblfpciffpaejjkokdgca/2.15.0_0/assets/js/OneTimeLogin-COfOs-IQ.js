import{a as t}from"./ResizeSensor-CXS_pGRc.js";import{O as e}from"./onboardingStepCollection-CDnR_iEN.js";import{o as s}from"./oneTimeLoginService-CgWRrBJN.js";import{u as i,d as o,A as a,n as r}from"./promisifiedChrome-CheD9WtZ.js";import"./environmentVariables-Cy83xda0.js";import"./VueBase-CjPGMLuv.js";import"./dashboard-CF_jRhAY.js";import"./main--IJuvtTE.js";import"./localStorage-B4mFdj8F.js";import"./preload-helper-D7CfCCEq.js";import"./Logger-Dqn8sDPg.js";import"./migrateLegacyUserMessageHandler-CU6TUnqH.js";import"./timestampDb-sTUCijT1.js";import"./index-CJJH83pl.js";import"./itemModelMixin-BHakSWl-.js";import"./reactiveCustomization-CrL2eTrh.js";import"./namesMixin-EAvqmdCw.js";import"./itemDataServiceMixins-R3DPkCUM.js";import"./focusModeHelpers-Cqkll3ju.js";import"./arrow-B0GpGOd-.js";import"./LinksService-BV1Om5gI.js";import"./icon-next-B4hjdiAA.js";import"./authService-B5VliZ3K.js";import"./SubscriptionSummary-Bb_CwKvU.js";import"./icon-confetti-Dz2LojDe.js";import"./siteBlockerGroups-1V1XRNi6.js";import"./constants-D-OQQ8lR.js";import"./compareObjects-BF7sSNEf.js";import"./string-KTo4Qfpe.js";const n=new a({feature:"one-time-login"});const p=r(t({name:"OneTimeLogin",props:{subSteps:{type:Array,required:!0},activeSubStepIndex:{type:Number,required:!0},otlParams:{type:Object,default:void 0}},emits:["goToSubStep","dismiss","stepComplete"],setup:()=>({OneTimeLoginState:e,oneTimeLoginData:void 0,helpUrl:"https://get.momentumdash.help/hc/en-us/articles/19764520037143"}),computed:{activeSubStep(){var t;return(null==(t=this.subSteps[this.activeSubStepIndex])?void 0:t.name)??e.ERROR}},async mounted(){var t;await this.redeemOneTimePassword();const s=i.userIsLegacyUnregistered()||!!localStorage.getItem("unregistered"),o=null==(t=this.oneTimeLoginData)?void 0:t.legacy;!s||o?await this.oneTimeLogin():this.setSubStep(e.UNSAVED_DATA)},methods:{setSubStep(t){const e=this.subSteps.findIndex((e=>e.name===t));-1!==e&&this.$emit("goToSubStep",e)},dismiss(){this.$emit("dismiss")},complete(){this.$emit("stepComplete")},displayErrorSubStep(t){let s="string"==typeof t?t:"unknown error";t instanceof Error&&(null==t?void 0:t.message)&&(s=t.message);const i=o(t,{default:s});console.error(i),n.capture("one time login error",{message:i.message}),this.setSubStep(e.ERROR)},goToRegistration(){m.cmd("modal.open","LOGIN",{force:!0})},async redeemOneTimePassword(){try{if(!this.otlParams)return this.displayErrorSubStep("no otl params defined");n.capture("one time password redeemed"),this.setSubStep(e.PROCESSING),s.startOneTimeLogin(),this.oneTimeLoginData=await s.redeemOnetimePassword(this.otlParams)}catch(t){this.displayErrorSubStep(t)}},async oneTimeLogin(){try{if(!this.oneTimeLoginData)return this.displayErrorSubStep("no one time login data");n.capture("one time login activated"),this.setSubStep(e.PROCESSING),await s.loginWithOneTimeLoginResponse(this.oneTimeLoginData),s.finalizeOneTimeLogin(),this.complete()}catch(t){this.displayErrorSubStep(t)}}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"one-time-login app reset-app-styles dark",attrs:{"data-test":"one-time-login"}},[e("transition",{attrs:{name:"fade",mode:"out-in",duration:350}},[e("div",{key:t.activeSubStep,staticClass:"content",attrs:{"data-test":t.activeSubStep}},[t.activeSubStep===t.OneTimeLoginState.PROCESSING?[e("h2",[t._v("Logging you in to Momentumâ€¦")])]:t.activeSubStep===t.OneTimeLoginState.UNSAVED_DATA?[e("h2",[t._v("Unsaved data found")]),e("p",[t._v("Create an account to save your data.")]),e("div",{staticClass:"actions"},[e("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"register"},on:{click:t.goToRegistration}},[t._v("Create account and save data")]),e("button",{staticClass:"dash-button",attrs:{"data-test":"proceed"},on:{click:t.oneTimeLogin}},[t._v("Continue without data")])]),e("div",{staticClass:"sub-actions"},[e("button",{attrs:{"data-test":"dismiss"},on:{click:t.dismiss}},[t._v("Cancel login")]),e("a",{attrs:{href:t.helpUrl}},[t._v("Help")])])]:t.activeSubStep===t.OneTimeLoginState.ERROR?[e("h2",[t._v("Oops! Something didn't work")]),e("p",[t._v("If the problem persists, please contact us.")]),e("div",{staticClass:"actions horizontal"},[e("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"dismiss"},on:{click:t.dismiss}},[t._v("Dismiss")]),e("a",{staticClass:"dash-button",attrs:{href:"https://momentumdash.com/contact","data-test":"contact-us"}},[t._v("Contact us")])]),e("div",{staticClass:"sub-actions"},[e("a",{attrs:{href:t.helpUrl}},[t._v("Help")])])]:t._e()],2)])],1)}),[],!1,null,"f0ce44d4").exports;export{p as default};