const __vite__fileDeps=["assets/js/apiUrl-BsWx-0bz.js","assets/js/environmentVariables-Cy83xda0.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as e,g as t}from"./preload-helper-D7CfCCEq.js";import{r as a,i as s,L as o}from"./Logger-Dqn8sDPg.js";import{e as r}from"./environmentVariables-Cy83xda0.js";const n="user:migration:",i={TIME:n+"time",FOCUS:n+"focus",ONBOARDING:n+"onboarding"},c=6e4,m=100,g={REGISTER:"register",FOCUS:"focus",ONBOARDING:"onboarding"},u=".legacyUserMigration",l="tab"+u,d="offscreenDocument"+u,f="backgroundScript"+u,I="syncedData:migration:lastAttempted",p="syncedData:migration:successful";async function S({context:n,tabId:i,loggerName:c},m){try{const o=await async function(o){const n=localStorage.getObject("momentum-customization-1").displayname,i=(await e((()=>import("./apiUrl-BsWx-0bz.js")),__vite__mapDeps([0,1]))).default(),c=await a({method:"post",url:i+"user:migrateLegacy?canceled=true",data:{name:n},headers:{"X-Momentum-Version":r.version,"X-Momentum-ClientDate":t(),"X-Momentum-ClientId":localStorage.getItem("client_uuid"),"X-Momentum-TabId":o}});if(s(null==c?void 0:c.status)&&c.data)return localStorage.setItem("token",c.data.token),localStorage.setItem("token_uuid",c.data.token_uuid),localStorage.setItem("unregistered",!0),c.data.settings;throw new Error("Legacy Migration Request Failed",c)}(i);m({success:!0,settings:o})}catch(u){if(console.error(u),c){new o(c).error(n+" migration error",{errorMessage:u.message,stack:u.stack,phase:g.REGISTER})}m({success:!1,error:u})}}export{d as L,I as M,f as a,i as b,l as c,c as d,m as e,g as f,p as g,S as m};