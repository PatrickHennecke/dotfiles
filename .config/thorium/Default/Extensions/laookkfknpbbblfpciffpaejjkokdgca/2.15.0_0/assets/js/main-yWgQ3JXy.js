import"./VueBase-CjPGMLuv.js";import{P as t}from"./Popup-Xs5lohqh.js";import{l as e,n as i,q as s,V as a}from"./ResizeSensor-CXS_pGRc.js";import{d as o,a as n,S as p}from"./onboardingStepCollection-CDnR_iEN.js";import{j as r,z as d,k as l,D as c}from"./dashboard-CF_jRhAY.js";import{u as S,n as h}from"./promisifiedChrome-CheD9WtZ.js";import{v as u}from"./v-style-D747Lejp.js";import"./index-CJJH83pl.js";import"./AppPopup-D_ukOJBQ.js";import"./globalKeyEventManager-KbJZwtdf.js";import"./icon-close-BUGl_M7j.js";import"./chevron-down-DdbU9YAr.js";import"./environmentVariables-Cy83xda0.js";import"./itemModelMixin-BHakSWl-.js";import"./reactiveCustomization-CrL2eTrh.js";import"./namesMixin-EAvqmdCw.js";import"./preload-helper-D7CfCCEq.js";import"./itemDataServiceMixins-R3DPkCUM.js";import"./timestampDb-sTUCijT1.js";import"./Logger-Dqn8sDPg.js";import"./focusModeHelpers-Cqkll3ju.js";import"./arrow-B0GpGOd-.js";import"./LinksService-BV1Om5gI.js";import"./icon-next-B4hjdiAA.js";import"./authService-B5VliZ3K.js";import"./SubscriptionSummary-Bb_CwKvU.js";import"./icon-confetti-Dz2LojDe.js";import"./siteBlockerGroups-1V1XRNi6.js";import"./constants-D-OQQ8lR.js";import"./compareObjects-BF7sSNEf.js";import"./main--IJuvtTE.js";import"./localStorage-B4mFdj8F.js";import"./migrateLegacyUserMessageHandler-CU6TUnqH.js";import"./string-KTo4Qfpe.js";const v=h({name:"ModalContainer",components:{Popup:t,vStyle:u},data:()=>({plans:{},plansError:!1,sales:{},transitionDisabled:!1,transitionName:void 0}),computed:{...e(c,["activeStep","activeSubStepIndex","locked","hidden"]),...i(c,["stepActive"]),activeSubStep(){return this.activeStep&&this.activeStep.subSteps&&this.activeStep.subSteps[this.activeSubStepIndex]||null}},watch:{async activeStep(t,e){var i;t!==e&&(t.key&&t.key===e.key&&(this.transitionDisabled=!0),null==(i=t.onShow)||i.call(t)),(null==t?void 0:t.getPlanInfo)&&!Object.keys(this.plans).length&&this.getPlanInfo().then((({plans:t={},sales:e={}}={})=>{this.plans=t,this.sales=e||{}})).catch((t=>{this.plansError=!0,console.error(t)})),0===Object.keys(e).length&&this.setActiveStepTransition()},"activeStep.hideOtherApps"(t,e){t?m.widgetManager.hideApps({layer:"modalContainer"}):e&&m.widgetManager.showApps({layer:"modalContainer"})}},created(){m.modals={stepsEnum:r,definitions:o},m.on("modal:show",this.showModal),m.on("modal:complete",this.handleStepCompletion),m.on("modal:close",this.dismissModal),m.on("modal:showUpgrade",this.showUpgrade),m.trigger("modalContainer:created:checkForced"),m.trigger("modalContainer:created"),this.checkParamsAndShowModal()},destroyed(){m.off("modal:show",this.showModal),m.off("modal:complete",this.handleStepCompletion),m.off("modal:close",this.dismissModal),m.off("modal:showUpgrade",this.showUpgrade),delete m.modals},methods:{async afterEnter(){await this.$nextTick(),this.transitionDisabled=!1},updateStepActiveProperties(t,{deactivate:e,activeSubStepIndex:i}={}){e?(this.$delete(t,"activeSubStepIndex"),this.$delete(t,"active")):(t.active||this.$set(t,"active",!0),t.subSteps&&void 0!==i&&this.$set(t,"activeSubStepIndex",i))},async showModal(t,{subStepIndex:e,force:i}={}){this.locked&&!i||(this.locked=!0,void 0===e&&(e="firstSubStep"in t?t.firstSubStep():0),"function"==typeof t.component&&await t.component(),this.activeStep=t,this.activeSubStepIndex=e,this.updateStepActiveProperties(this.activeStep,{activeSubStepIndex:this.activeSubStepIndex}))},async handleSubStepCompletion(t){var e,i;const s="modal:subStepCompletionIntercepted";if(!0===t&&this.$e.$off(s),this.activeSubStep.interceptNextStep&&!0!==t)return this.$e.$off(s),this.$e.$on(s,this.handleSubStepCompletion.bind(this,!0)),void this.$e.$emit("modal:interceptSubStepCompletion");const a=this.activeSubStep,o=this.activeSubStepIndex,n=this.activeStep.subSteps&&this.activeSubStepIndex<this.activeStep.subSteps.length-1;n&&(this.activeSubStepIndex++,this.updateStepActiveProperties(this.activeStep,{activeSubStepIndex:this.activeSubStepIndex})),await(null==(i=(e=this.activeStep).onSubStepComplete)?void 0:i.call(e,{activeSubStep:a,activeSubStepIndex:o,nextSubStepIndex:this.activeSubStepIndex,nextSubStep:this.activeSubStep,hasSubStepsRemaining:n})),n||await this.handleStepCompletion()},async handleStepCompletion({state:t}={state:p.Completed}){var e,i;const s=this.activeStep;await(null==(e=s[n[t]])?void 0:e.call(s,{activeSubStep:this.activeSubStep,activeSubStepIndex:this.activeSubStepIndex})),this.updateStepActiveProperties(s,{deactivate:!0}),this.activeSubStepIndex=0,this.locked=!1,await(null==(i=s.onLeave)?void 0:i.call(s,t)),s.id===this.activeStep.id&&(this.activeStep={})},showUpgrade(){var t,e;null==(e=(t=this.activeStep).onUpgradeClick)||e.call(t),m.utils.useAppleAppPayment()&&m.isLoggedIn()?d():this.showModal(o[l()],{force:!0})},dismissModal(){this.handleStepCompletion({state:p.Dismissed})},handleModalError(){this.handleStepCompletion({state:p.Errored}),this.$set(this.activeStep,"error",!0)},goToSubStep(t){this.activeSubStepIndex=t,this.updateStepActiveProperties(this.activeStep,{activeSubStepIndex:this.activeSubStepIndex})},getPlanInfo(){return this.$xhr.get("account/plans",{timeout:8e3}).then((({data:t})=>{if(!t)throw new Error("no data for plans");return localStorage.getItem("sale:force")&&m.utils.isDev()&&(t.personal.sales={yearly:s}),t.personal}))},setActiveStepTransition(){this.transitionName=this.activeStep.transitionName||(["top-right","top-left"].includes(this.activeStep.position)?"fade-slide-up":"fade-slide-down")},checkParamsAndShowModal(){const t=S.getAndRemoveParamsFromUrl("modalStep","modalSubStepIndex");t.modalStep&&this.showModal(o[r[t.modalStep]],{subStepIndex:Number(t.modalSubStepIndex??"0")})}}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal-container",attrs:{"data-test":"modal-container"},on:{mousedown:function(t){t.stopPropagation()},mouseup:function(t){t.stopPropagation()}}},[e("transition",{attrs:{name:t.transitionName,css:!t.transitionDisabled,mode:"out-in"},on:{"after-enter":t.afterEnter,"after-leave":t.setActiveStepTransition}},[t.stepActive&&!t.hidden?e(t.activeStep.component||"Popup",t._b({key:t.activeStep.id,tag:"component",staticClass:"modal-component",attrs:{plans:t.plans,"plans-error":t.plansError,sales:t.sales,"active-sub-step-index":t.activeSubStepIndex,"active-sub-step":t.activeSubStep,hidden:t.hidden},on:{error:t.handleModalError,dismiss:t.dismissModal,stepComplete:t.handleStepCompletion,subStepComplete:t.handleSubStepCompletion,goToSubStep:t.goToSubStep,upgrade:t.showUpgrade}},"component",t.activeStep,!1)):t._e()],1),e("transition-group",{attrs:{duration:500}},[t.activeStep&&t.activeStep.customCss?e("v-style",{key:t.activeStep.id},[t._v(t._s(t.activeStep.customCss))]):t._e(),t.activeSubStep&&t.activeSubStep.customCss?e("v-style",{key:t.activeSubStepIndex},[t._v(t._s(t.activeSubStep.customCss))]):t._e()],1)],1)}),[],!1,null,"70b61aa8").exports;if(!m.modals){const t=new a({render:t=>t(v)}).$mount();document.querySelector(".apps .full").appendChild(t.$el)}