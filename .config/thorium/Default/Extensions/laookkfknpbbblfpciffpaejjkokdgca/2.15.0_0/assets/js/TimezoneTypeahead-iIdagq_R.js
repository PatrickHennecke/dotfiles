import e from"./LocationTypeahead-D46TS98Q.js";import{g as t}from"./ResizeSensor-CXS_pGRc.js";import{g as o}from"./globalKeyEventManager-KbJZwtdf.js";import{n as i}from"./promisifiedChrome-CheD9WtZ.js";import"./SoftFocus-BUhesXB-.js";import"./SmoothReflow-B3dWZqEj.js";import"./allComponentsMounted-C3UsG_cA.js";import"./environmentVariables-Cy83xda0.js";import"./timestampDb-sTUCijT1.js";import"./Logger-Dqn8sDPg.js";import"./preload-helper-D7CfCCEq.js";import"./string-KTo4Qfpe.js";const a=t.map((({name:e,id:t})=>{const o=e.includes("-"),i=e.substring(3),a=i.replace(":",""),[n,s]=i.substring(1).split(":");return{name:e,shortName:e,offset:(60*n+s)*(o?-1:1),searchable:a,timeZoneId:t}}));const n=i({name:"TimezoneTypeahead",components:{LocationTypeahead:e},props:{value:{type:Object,required:!0},componentFieldWarnings:{type:Array,default:()=>[]}},data:()=>({warning:!1,loadingTimezone:!1}),computed:{transformedValue(){return{name:this.value.timeZoneName,...this.value}}},watch:{componentFieldWarnings(e){e.includes("timeZoneId")&&(this.warning=!0),setTimeout((()=>this.warning=!1),1e3)}},created(){o.registerEventListener("closeResults","keyup",27,(()=>{this.$refs.typeahead.clear()}))},destroyed(){o.removeEventListener("closeResults","keyup",27)},methods:{async getTimezone({shortName:e,name:t,latitude:o,longitude:i,offset:a=0,timeZoneId:n=""}={}){if(this.$emit("input",{shortName:e,timeZoneName:t,offset:a,timeZoneId:n}),void 0===arguments[0].timeZoneId){this.loadingTimezone=!0;try{const{data:{name:a,offset:n}}=await this.$xhr.get(`/timezones:search?latitude=${o}&longitude=${i}`);this.$emit("input",{shortName:e,name:name,offset:n,timeZoneId:a,timeZoneName:t})}catch(s){console.error(s)}finally{this.loadingTimezone=!1}}},interceptUtcSearch(e){var t;const o=e.toLowerCase().trim();if(o.includes("utc")||o.includes("gmt")){const e=(null==(t=o.replace(":","").match(/(\d|-|\+)+/))?void 0:t[0])||"",i=m.utils.fuzzyFilter(e,a,"searchable");if(i.length)return i}}}},(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"label-wrapper"},[t("label",[e._v("Location")]),e.loadingTimezone?t("div",{staticClass:"loading-icon",attrs:{"data-test":"loading-timezone"}}):e._e()]),t("location-typeahead",{ref:"typeahead",class:{pulse:e.warning},attrs:{"before-fetch-results":e.interceptUtcSearch,value:e.transformedValue,type:"timezone"},on:{input:e.getTimezone}})],1)}),[],!1,null,"d1de99f8").exports;export{n as default};