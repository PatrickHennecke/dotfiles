import{R as t}from"./ResizeSensor-CXS_pGRc.js";import{c as e}from"./reactiveCustomization-CrL2eTrh.js";import{n as o,A as s}from"./promisifiedChrome-CheD9WtZ.js";import{a as i}from"./allComponentsMounted-C3UsG_cA.js";import{s as a}from"./showAnyway-CbfR58eh.js";import{B as r}from"./BaseDropdownOption-CckvXbkm.js";import{B as n}from"./BaseDropdownDivider-Do6boaEI.js";import{B as c}from"./BaseDropdown-BAkdZe-R.js";import{_ as d}from"./icon-heart-v5O7C6eS.js";import{_ as u}from"./icon-skip-intro-BUi8b3Ak.js";import{_ as l,a as p}from"./icon-x-qUCmf2CW.js";import{_ as h}from"./icon-cog-BFr_Pva7.js";import"./environmentVariables-Cy83xda0.js";import"./VueBase-CjPGMLuv.js";import"./dashboard-CF_jRhAY.js";import"./main--IJuvtTE.js";import"./localStorage-B4mFdj8F.js";import"./preload-helper-D7CfCCEq.js";import"./Logger-Dqn8sDPg.js";import"./migrateLegacyUserMessageHandler-CU6TUnqH.js";import"./timestampDb-sTUCijT1.js";import"./index-CJJH83pl.js";import"./string-KTo4Qfpe.js";import"./icon-ellipsis-D3jS4u3x.js";var v=[],g=function(){var t,e;for(e=0;e<v.length;e+=1)(t=v[e]).style.maxWidth="",f(t)&&w(t,t.clientHeight,0,t.clientWidth)},w=function(t,e,o,s){var i;o>=s?t.style.maxWidth=s+"px":(i=(o+s)/2,t.style.maxWidth=i+"px",t.clientHeight>e?w(t,e,i+1,s):w(t,e,o+1,i))},f=function(t){var e,o,s,i,a;return a=t.innerHTML,10,s=t.innerHTML.split(" "),(i=document.createElement("span")).id="element-first-word",i.innerHTML=s[0],s=s.slice(1),t.innerHTML="",t.appendChild(i),t.innerHTML+=" "+s.join(" "),e=(i=document.getElementById("element-first-word")).offsetHeight,o=t.offsetHeight,t.innerHTML=a,o-10>e};const b=Backbone.Model.extend({defaults:{_id:"",body:"",source:"",is_custom:!1,detail_url:"",twitter:""},idAttribute:"forDate"}),Q=m.models.FeedManager.extend({initialize:function(){m.models.FeedManager.prototype.initialize.call(this,m.models.Quote,"quote")}}),y=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("momentum-quote"),model:m.models.Quote,getActiveItem:function(){if(this.length>0){let t=m.utils.getDateString();return this.get(t)}}}),_=new s({feature:"quotes"});m.models.Quote=b,m.collect.Quotes=y,m.collect.quotes=new y,m.models.QuoteManager=Q,m.models.quoteManager=new Q;const q=o({name:"Quote",components:{BaseDropdown:c,BaseDropdownDivider:n,BaseDropdownOption:r},bb:()=>({collection:m.collect.quotes}),directives:{ResizeSensor:t},mixins:[i],setup:()=>({debounedHover:null}),data:()=>({wrappedBodyArray:"",activeQuoteId:"",skipping:!1,dropdownActive:!1,quoteOverride:""}),computed:{showAnyway:()=>a.includes("quote"),quoteVisible:()=>e.quoteVisible,activeQuote(){return this.quoteOverride||this.collection.get(this.activeQuoteId)},quoteUuid(){return this.activeQuote?this.activeQuote.get("_id"):""},isCustom(){return!!this.activeQuote&&this.activeQuote.get("is_custom")},body(){return this.activeQuote?`“${this.activeQuote.get("body")}”`:""},bodyArray(){return this.body.split(" ")},source(){return this.activeQuote?this.activeQuote.get("source"):""},detailUrl(){return this.activeQuote?this.activeQuote.get("detail_url"):""},twitter(){return this.activeQuote?this.activeQuote.get("twitter"):""},twitterIntentUrl(){if(!this.activeQuote)return"";const t=this.activeQuote.get("twitterIntentUrl");if(t)return t;const e=this.twitter?`"${this.body}" -@${this.twitter} #motivation`:`"${this.body}" -${this.source} #motivation`;return"https://x.com/intent/tweet?text="+encodeURIComponent(e)+"&via=momentumdash&related=momentumdash,levibucsis"},isFavorite(){return!!this.activeQuote&&this.activeQuote.get("is_favorite")}},created(){m.models.quoteManager.firstFetch(),this.setQuote(),m.on("newDay",this.setQuote),m.collect.quotes.on("reset add change sync refresh",this.setQuote),m.on("appsReady",this.wrapQuoteAndWatch),m.on("quote:override",this.overrideQuote),m.trigger("quote:created")},destroyed(){m.off("newDay",this.setQuote),m.collect.quotes.off("reset add change sync refresh",this.setQuote),m.off("appsReady",this.wrapQuoteAndWatch),m.off("quote:override",this.overrideQuote)},methods:{overrideQuote(t){this.quoteOverride=t?{body:t,forDate:m.utils.getDateString(),_id:m.utils.uuidv4(),get(t){return this[t]}}:null},handleClick(){var t;this.$touch&&(null==(t=this.$refs.settingsDropdown)||t.openDropdown()),this.detailUrl&&this.detailUrl.length>0&&window.open(this.detailUrl,"_blank")},captureDebouncedHover(t){const e=t.target;this.cancelDebouncedHoverCapture(),this.debounedHover=setTimeout((()=>{e.matches(":hover")&&_.capture("quote hover",{custom:this.isCustom})}),1e3)},cancelDebouncedHoverCapture(){clearTimeout(this.debounedHover)},shareTwitter(){var t;let e=screen.width/2-272.5,o=screen.height/2-210;null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),window.open(this.twitterIntentUrl,"share","left="+e+",top="+o+",width=545,height=420,resizeable=0"),_.capture("quote tweet click",{custom:this.isCustom})},toggleFavorite(){let t=this.activeQuote.is_favorite=!this.isFavorite;m.models.quoteManager.toggleFavorite(t).catch((()=>this.activeQuote.is_favorite=!t)),_.capture("quote "+(t?"fav":"unfav"),{custom:this.isCustom,location:"dash"})},skipQuote(){var t;if(!this.$plus)return null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),void m.cmd("modal.open","UPSELL_QUOTES",{eventSource:"dash"});this.skipping||(this.skipping=!0,setTimeout((()=>{m.models.quoteManager.skipItem().finally((()=>{this.skipping=!1})),_.capture("quote skip",{is_paid_event:!0,custom:this.isCustom})}),450))},wrapQuoteAndWatch(){this.wrapQuote(),this.watcher||(this.watcher=this.$watch("body",this.wrapQuote))},wrapQuote(){this.$nextTick((()=>{var t;t=".quote .body .body-text",v=document.querySelectorAll(t),g(),this.$nextTick((()=>{m.trigger("quote:updated")}))}))},setQuote(){this.activeQuoteId=this.getActiveQuote()},getActiveQuote(){let t;return this.collection.length>0&&(t=this.collection.getActiveItem()),t?(m.trigger("quote:downloaded"),t.id):(m.trigger("sync:download","quote"),"")},openSettings(){var t;null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),m.commandManager.executeAsync("settings.display",null,{section:"quote-settings"})},openDropdown(){var t;null==(t=this.$refs.settingsDropdown)||t.openDropdown()},onDropdownToggle(t){this.dropdownActive=t},access:m.utils.access}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container quote",class:{"show-anyway":t.showAnyway},attrs:{"data-test":"quote","data-show-anyway":"quote"}},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.activeQuote?e("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.wrapQuote,expression:"wrapQuote"}],key:t.quoteUuid,staticClass:"app-dash",class:{active:t.dropdownActive},attrs:{"data-test":"app-dash"},on:{mouseenter:t.captureDebouncedHover,mouseleave:t.cancelDebouncedHoverCapture,click:function(e){return e.preventDefault(),t.handleClick(e)},dblclick:t.openDropdown}},[e("p",{staticClass:"body"},[e("span",{staticClass:"body-text",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))])]),e("div",{staticClass:"below"},[e("div",{staticClass:"below-actions",attrs:{"data-test":"below"}},[t.source?e("span",{staticClass:"source u--mobile-hide",attrs:{"data-test":"source"}},[t._v(t._s(t.source))]):t._e(),e("base-dropdown",{ref:"settingsDropdown",attrs:{"container-class":"app","data-test":"settings-dropdown","mobile-toggle-hidden":!0},on:{toggle:t.onDropdownToggle},scopedSlots:t._u([{key:"toastHeader",fn:function(){return[e("div",{staticClass:"toast-title",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))]),t.source?e("div",{staticClass:"toast-source",attrs:{"data-test":"source"}},[t._v("– "+t._s(t.source))]):t._e()]},proxy:!0}],null,!1,3597242828)},[e("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:t.toggleFavorite}},[e("span",{class:["favorite",{active:t.isFavorite}],attrs:{"data-test":"favorite-icon"}},[e("inline-svg",{staticClass:"icon icon-heart",attrs:{src:d}})],1),t._v(" "+t._s(t.isFavorite?"Unfavorite":"Favorite")+" ")]),e("base-dropdown-option",{attrs:{"data-test":"skip"},on:{click:t.skipQuote}},[e("inline-svg",{staticClass:"icon",attrs:{src:u}}),t._v(" Skip to new quote "),t.$plus?t._e():e("span",{staticClass:"badge badge-plus"},[t._v("PLUS")])],1),e("base-dropdown-option",{attrs:{"data-test":"share"},on:{click:t.shareTwitter}},[e("inline-svg",{staticClass:"icon icon-x",attrs:{src:l}}),t._v(" Share ")],1),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"manage"},on:{click:t.openSettings}},[e("inline-svg",{staticClass:"icon",attrs:{src:p}}),t._v(" Manage quotes ")],1),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"settings"},on:{click:t.openSettings}},[e("inline-svg",{staticClass:"icon",attrs:{src:h}}),t._v(" Settings ")],1)],1)],1)])]):t._e()])],1)}),[],!1,null,"9b9ca890").exports;export{q as default};