import{f as e,E as t,q as i,v as s}from"./promisifiedChrome-CheD9WtZ.js";import{M as a}from"./timestampDb-sTUCijT1.js";import{d as r,V as d}from"./ResizeSensor-CXS_pGRc.js";import{u as o}from"./preload-helper-D7CfCCEq.js";import{E as l,g as n,d as c,f as u,e as h,h as m}from"./constants-D-OQQ8lR.js";import{a as p}from"./compareObjects-BF7sSNEf.js";class g{constructor(e){this.dataSyncService=e}get(e){this.dataSyncService.get(e)}create(e){return this.dataSyncService.create(e.id,e)}update(e,t){return this.dataSyncService.update(e,t)}delete(e){return this.dataSyncService.delete(e)}}class f{constructor(e){this.dataSyncService=e}get(e){this.dataSyncService.get(e)}create(e){return this.dataSyncService.create(e.id,e)}update(e,t){return this.dataSyncService.update(e,t)}delete(e){return this.dataSyncService.delete(e)}}const w=()=>({siteBlockerGroupsService:new g(new e("siteBlockerGroups",{mode:a.Timestamp,queueKey:"siteBlocker",path:"site-blocker/groups"})),siteBlockerWebsitesService:new f(new e("siteBlockerWebsites",{mode:a.Timestamp,queueKey:"siteBlocker",path:"site-blocker/websites"}))});class S{constructor({id:e=o(),name:t="",order:i,enabled:s=!0,defaultKey:a="",defaultDeleted:r=!1,totalWebsites:d=0}){this.id=e,this.name=t,this.enabled=s,this.defaultKey=a,this.defaultDeleted=r,this.totalWebsites=d,this.order=i}}class b{constructor({id:e=o(),url:t="",name:i="",order:s,enabled:a=!0,groupId:r,defaultKey:d="",defaultDeleted:l=!1}){this.id=e,this.name=i,this.url=t,this.enabled=a,this.groupId=r,this.defaultKey=d,this.defaultDeleted=l,this.order=s}validate(){if(""===this.name)throw new t({message:l.NameEmpty,input:"name-input"});if(""===this.url)throw new t({message:l.UrlEmpty,input:"url-input"});if(!i(s(this.urlWithReplacedWildcard)))throw new t({message:l.UrlInvalid,input:"url-input"});if(this.url.includes(" "))throw new t({message:l.UrlSpaces,input:"url-input"});if(this.url.includes("/"))throw new t({message:l.UrlPaths,input:"url-input"});const e=this.url.split("").filter((e=>"*"===e)).length;if(e>1||1===e&&!this.url.endsWith(".*"))throw new t({message:l.UrlWildcard,input:"url-input"})}get urlWithReplacedWildcard(){return this.url.replace(".*",".com")}get hostWithWildcard(){const e=new URL(s(this.urlWithReplacedWildcard)).host;return this.url.endsWith(".*")?e.replace(".com",".*"):e}}const v=(e=w().siteBlockerWebsitesService)=>r("siteBlockerWebsites",{state:()=>({data:{},loaded:!1,loading:!1,activeItem:null}),getters:{getWebsitesByGroup:e=>t=>n(e.data).filter((e=>e.groupId===t.id||e.groupId===t.defaultKey)).sort(((e,t)=>t.order-e.order)).map((e=>new b(e))),activeItemHasChanges(e){if(!e.activeItem)return!1;const t=e.data[e.activeItem.id];return t?Object.keys(p(t,e.activeItem)).length>0:""!==e.activeItem.url||""!==e.activeItem.name},getWebsiteOrDefaultFromId:e=>t=>e.data[t]??c[t]},actions:{clearActiveItem(){this.activeItem=null},newItem(e){this.activeItem||(this.activeItem=new b({groupId:e.id,order:this.getWebsitesByGroup(e).length}))},editItem(e){const i=this.getWebsiteOrDefaultFromId(e);if(!i)throw new t({message:`No Site Blocker website found with id: ${e}`});this.activeItem=new b(i)},refresh(){this.loading||this.loaded||(this.loading=!0,e.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loading=!1,this.loaded=!0},failure:()=>{this.loading=!1}}))},async create(t){d.set(this.data,t.id,t);const i=k(),s=u(t,i.data),a=u(t,h);!s&&a&&await i.create({...a}),s?t.groupId=s.id:a&&(t.groupId=a.id),await e.create(t)},async update(i,s){const a=c[i];if(!this.data[i]&&a)return this.create({...a,...s});const r=this.data[i];if(!r)throw new t({message:`No Site Blocker website found with id: ${i}`});d.set(this.data,i,{...r,...s}),await e.update(i,s)},async delete(t){const i=c[t];if(!this.data[t]&&i)return this.update(t,{defaultDeleted:!0});this.data[t]&&(d.delete(this.data,t),await e.delete(t))}}}),y=v(),I=Object.freeze(Object.defineProperty({__proto__:null,default:y,makeSiteBlockerWebsitesStore:v},Symbol.toStringTag,{value:"Module"})),W=(e=w().siteBlockerGroupsService)=>r("siteBlockerGroups",{state:()=>({data:{},loaded:!1,loading:!1,activeItem:null}),getters:{items(e){const t=y();return m(e.data).sort(((e,t)=>t.order-e.order)).map((e=>new S({...e,totalWebsites:t.getWebsitesByGroup(e).length})))},getGroupOrDefaultFromId:e=>t=>e.data[t]??h[t]},actions:{clearActiveItem(){this.activeItem=null},newItem(){this.activeItem||(this.activeItem=new S({order:this.items.length}))},editItem(e){const i=this.getGroupOrDefaultFromId(e);if(!i)throw new t({message:`No Site Blocker group found with id: ${e}`});const s=y();this.activeItem=new S({...i,totalWebsites:s.getWebsitesByGroup(i).length})},refresh(){this.loading||this.loaded||(this.loading=!0,e.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loading=!1,this.loaded=!0},failure:()=>{this.loading=!1}}))},async create(t){d.set(this.data,t.id,t),await e.create(t)},async update(i,s){const a=h[i];if(!this.data[i]&&a)return this.create({...a,...s});const r=this.data[i];if(!r)throw new t({message:`No Site Blocker group found with id: ${i}`});d.set(this.data,i,{...r,...s}),await e.update(i,s)},async delete(t){const i=this.getGroupOrDefaultFromId(t);if(!i)return;const s=y();if(await Promise.all([s.getWebsitesByGroup(i).map((e=>s.delete(e.id)))]),i.defaultKey)return this.update(t,{defaultDeleted:!0});d.delete(this.data,t),await e.delete(t)}}}),k=W(),B=Object.freeze(Object.defineProperty({__proto__:null,default:k,makeSiteBlockerGroupsStore:W},Symbol.toStringTag,{value:"Module"}));export{S,y as a,B as b,I as s,k as u};