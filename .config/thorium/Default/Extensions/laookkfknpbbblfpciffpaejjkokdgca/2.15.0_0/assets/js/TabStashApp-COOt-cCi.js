import{c as t}from"./BaseIcon-CACrCBea.js";import{A as e}from"./AppViewSwitchDynamic-BYU6AUAL.js";import{A as s}from"./AppPopup-D_ukOJBQ.js";import{A as i}from"./AppHeader-DGqF8Ifm.js";import{A as o}from"./AppLoading-DeR9IIx3.js";import{A as n}from"./AppView-CyOtvy2t.js";import{A as a}from"./AppEmpty-BrSPSkb0.js";import{A as r}from"./AppConfirmCancel-Wgs8gVfQ.js";import{B as l}from"./BaseDropdown-BAkdZe-R.js";import{B as c}from"./BaseDropdownOption-CckvXbkm.js";import{B as p}from"./BaseItemList-DEa4hADS.js";import{a as d}from"./allComponentsMounted-C3UsG_cA.js";import{S as u,T as h,a as f,p as w,b as v,W as b,G as S,u as g,H as j,m as y}from"./tabs-DMLMRbv1.js";import{n as C,B as _,A as T,T as k,C as A}from"./promisifiedChrome-CheD9WtZ.js";import{_ as D}from"./icon-edit-CixeXNYx.js";import{_ as x}from"./icon-trash-DFxJwJNo.js";import{_ as P,s as E}from"./dashboard-CF_jRhAY.js";import{a as L}from"./ResizeSensor-CXS_pGRc.js";import{B as V}from"./BaseDropdownDivider-Do6boaEI.js";import{F as R}from"./FavIcon-Cddzo7ot.js";import{A as O}from"./AppHeaderControl-BC-AHodD.js";import{f as B}from"./flashMessageMixin-BWjGkbzu.js";import{r as I}from"./icon-weather-reset-D7qA-OAP.js";import{_ as F}from"./icon-back-arrow-CiRQJ6G-.js";import"./arrow-B0GpGOd-.js";import"./icon-settings-Bycjf8-G.js";import"./icon-chrome-BdhFuvxf.js";import"./icon-back-D_TFrgyJ.js";import"./icon-check-Vc9B11BJ.js";import"./icon-circle-D-D5U4qS.js";import"./icon-close-BUGl_M7j.js";import"./icon-cog-BFr_Pva7.js";import"./icon-skip-BOkC5L0N.js";import"./icon-down-BiHbKN-t.js";import"./icon-ellipsis-D3jS4u3x.js";import"./icon-error-state-BKQhfBCj.js";import"./icon-heart-v5O7C6eS.js";import"./icon-hide-NFfBhfBx.js";import"./icon-key-BPNRipb3.js";import"./icon-lock-B0ekkj2F.js";import"./icon-next-B4hjdiAA.js";import"./icon-photo-BrwqV1T0.js";import"./icon-pin-BHeOuzvO.js";import"./icon-plus-D4YOesIc.js";import"./icon-profile-B_XWyuTb.js";import"./icon-x-qUCmf2CW.js";import"./icon-skip-intro-BUi8b3Ak.js";import"./icon-tooltip-CN09iXOB.js";import"./icon-visible-on-CM3kpcFN.js";import"./icon-x-caret-half-CZtcH_PM.js";import"./star-rating-CNohptmf.js";import"./pomodoro-circle-Dx_GWql1.js";import"./star-KworSO8x.js";import"./thanks-DfYnO-qW.js";import"./add-COIuonao.js";import"./google-DKPAcOmk.js";import"./arrow-up-1QPpu78M.js";import"./chevron-down-DdbU9YAr.js";import"./pomodoro-DvfTwCi0.js";import"./clocks-DjzskNOU.js";import"./close-D7GCNZxm.js";import"./search-DCqlmJx6.js";import"./folder-CwWTWsnJ.js";import"./switch-EuBTQVVE.js";import"./focus-mode-09pIyYAW.js";import"./storage-YYEO5TB5.js";import"./icon-confetti-Dz2LojDe.js";import"./wind-D3u4taeq.js";import"./sparks-CAw9b6ob.js";import"./secure-B8YP-AML.js";import"./icon-percent-schedule-CA5EI9b7.js";import"./icon-trello-BoqqWb7o.js";import"./icon-clean-rFsPxTtp.js";import"./icon-more-lists-Dg-hN7s6.js";import"./icon-more-fonts-CcfOY0t4.js";import"./icon-focus-stats-keERwXFt.js";import"./icon-easy-access-BZifTR0C.js";import"./icon-top-of-mind-B6EhbCcK.js";import"./icon-flow-5QqmGIWX.js";import"./icon-focused-JrsBbR-K.js";import"./icon-weather-extra-ufLpT_SX.js";import"./icon-spiral-gh4hwZDD.js";import"./icon-happy-place-D1z6CJgM.js";import"./icon-time-sensitive-CP2L3maw.js";import"./icon-hourly-CdMmiQZT.js";import"./icon-infinity-D4yMRoAd.js";import"./icon-integrations-Y-aXZTst.js";import"./icon-kanban-Dodqg7y-.js";import"./icon-personalize-photos-D2M4lLlt.js";import"./icon-personalize-n8qjJGGA.js";import"./icon-photo-match-C2EChNEK.js";import"./icon-random-375DbcwF.js";import"./icon-timezones-DGZoTtaT.js";import"./icon-simplify-BRUtLJYp.js";import"./icon-skip-Bd6EhalI.js";import"./icon-sync-DIH26Y9h.js";import"./SmoothReflow-B3dWZqEj.js";import"./appViewSwitchMixin-BsLJ76Hr.js";import"./globalKeyEventManager-KbJZwtdf.js";import"./preload-helper-D7CfCCEq.js";import"./VueBase-CjPGMLuv.js";import"./index-CJJH83pl.js";import"./constants-BpVlFj04.js";import"./timestampDb-sTUCijT1.js";import"./Logger-Dqn8sDPg.js";import"./environmentVariables-Cy83xda0.js";import"./string-KTo4Qfpe.js";import"./main--IJuvtTE.js";import"./localStorage-B4mFdj8F.js";import"./migrateLegacyUserMessageHandler-CU6TUnqH.js";const M=C({name:"SessionConfirmDelete",components:{AppConfirmCancel:r},props:{session:{type:u,required:!0}},emits:["cancel","delete"],computed:{deleteProps(){return{title:"Are you sure you want to delete this session?",description:this.session.sessionDescriptionTabs+(this.session.windows.length>1?" "+this.session.sessionDescriptionWindows:""),confirm:()=>this.$emit("delete"),confirmText:"Delete session",cancel:()=>this.$emit("cancel"),cancelText:"Keep session",dataTest:"confirm-delete"}}}},(function(){var t=this,e=t._self._c;return e("div",[e("app-confirm-cancel",t._b({attrs:{"data-test":"confirm-delete"}},"app-confirm-cancel",t.deleteProps,!1))],1)}),[],!1,null,"207670b1").exports;const H=C({name:"SessionListItem",components:{BaseDropdownOption:c,BaseDropdown:l,SessionConfirmDelete:M},mixins:[d],inject:["viewStateStore","itemStore"],props:{session:{type:u,required:!0}},emits:["delete","restore"],data(){return{editingTitle:!1,tempTitle:this.session.displayName,deleteConfirmationOpen:!1}},unreactive:()=>({titleClickDebounce:0,titleClickCounter:0}),computed:{displayName(){return this.session.displayName},iconCrossBrowserWarnVisible(){return this.session.browser!==_()}},watch:{async editingTitle(t){var e,s;t&&(await this.$nextTick(),null==(e=this.$refs.editingTitle)||e.focus(),await this.$nextTick(),null==(s=this.$refs.editingTitle)||s.select())}},methods:{openDeleteConfirmation(){this.deleteConfirmationOpen=!0},closeDeleteConfirmation(){this.deleteConfirmationOpen=!1},renameSession(){var t;this.editingTitle=!0,null==(t=this.$refs["tabs-dropdown"])||t.closeDropdown()},handleTitleChange(){var t;const e=null==(t=this.tempTitle)?void 0:t.trim();e?e!==this.displayName&&this.itemStore.update(this.session.id,{name:e}):this.revertTitle(),this.editingTitle=!1},revertTitle(){this.tempTitle=this.session.displayName,this.editingTitle=!1},switchViewToDetail(){this.itemStore.activeItemId=this.session.id,this.viewStateStore.setActiveView(h.Detail)}}},(function(){var t=this,e=t._self._c;return e("li",{staticClass:"session-list-item",attrs:{"data-test":"session-item"},on:{click:t.switchViewToDetail}},[e("div",{staticClass:"upper-row"},[t.editingTitle?e("span",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempTitle,expression:"tempTitle"}],ref:"editingTitle",staticClass:"title-input",attrs:{spellcheck:"false","data-test":"display-name-input",maxlength:"255"},domProps:{value:t.tempTitle},on:{click:function(t){t.stopPropagation()},keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleTitleChange.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:(e.stopPropagation(),t.revertTitle.apply(null,arguments))}],blur:t.handleTitleChange,input:function(e){e.target.composing||(t.tempTitle=e.target.value)}}})]):e("span",{staticClass:"title",attrs:{"data-test":"display-name"}},[t._v(t._s(t.displayName))]),e("div",{staticClass:"list-item-control",attrs:{"data-test":"session-item-control"},on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"restore",attrs:{"data-test":"restore-session"},on:{click:function(e){return t.$emit("restore")}}},[t._v("Restore")]),e("base-dropdown",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.closeDeleteConfirmation,expression:"closeDeleteConfirmation"}],ref:"tabs-dropdown",attrs:{"data-test":"session-dropdown"},on:{toggle:t.closeDeleteConfirmation}},[t.deleteConfirmationOpen?[e("session-confirm-delete",{attrs:{session:t.session},on:{cancel:t.closeDeleteConfirmation,delete:function(e){return t.$emit("delete")}}})]:[e("base-dropdown-option",{attrs:{"data-test":"rename-session"},on:{click:t.renameSession}},[e("inline-svg",{staticClass:"icon icon-edit",attrs:{src:D}}),e("span",{staticClass:"text"},[t._v("Rename")])],1),e("base-dropdown-option",{attrs:{"data-test":"delete-session"},on:{click:t.openDeleteConfirmation}},[e("inline-svg",{staticClass:"icon icon-delete",attrs:{src:x}}),e("span",{staticClass:"text"},[t._v("Delete")])],1)]],2)],1)]),e("div",{staticClass:"bottom-row"},[t.iconCrossBrowserWarnVisible?e("div",{staticClass:"icon-cross-browser-warn",attrs:{"data-test":"cross-browser-warn",title:"This session was created on another browser. Browser-specific pages might not be restored"}},[e("inline-svg",{staticClass:"icon icon-delete",attrs:{src:P}})],1):t._e(),e("div",{staticClass:"session-description",attrs:{"data-test":"session-description"}},[e("span",[t._v(t._s(t.session.sessionDescriptionTabs))]),t.session.windows.length>1?e("span",[t._v(t._s(t.session.sessionDescriptionWindows))]):t._e()])])])}),[],!1,null,"3b648f8d").exports;const $=C(L({name:"AppActionBanner",props:{actionText:{type:String,required:!0},text:{type:String,required:!0}},emits:["action"]}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"app-action-banner"},[t._v(" "+t._s(t.text)+" "),e("span",{on:{click:function(e){return t.$emit("action")}}},[t._v(t._s(t.actionText))])])}),[],!1,null,"7f13165b").exports;const N=C({name:"SessionDetailTab",components:{FavIcon:R},props:{tab:{type:f,required:!0}}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"tab",attrs:{title:t.tab.url}},[e("fav-icon",{staticClass:"favicon",attrs:{url:"chrome://newtab/"===t.tab.url?"https://momentumdash.com":t.tab.url}}),e("div",{staticClass:"name"},[t._v(t._s(t.tab.title))])],1)}),[],!1,null,"ca432818").exports,U=w().tabStashService,G=new T({feature:"tab stash"});const q=C({name:"SessionDetail",components:{SessionDetailTabItem:N},props:{session:{type:u,required:!0}},unreactive:()=>({TabOrGroupType:v}),methods:{openPartialSession(t){let e=1;t instanceof b&&(e=t.tabCount),t instanceof S&&(e=t.tabs.length),G.capture("restore tabs",{tab_count:e,window_count:t instanceof b?1:0,partial:!0}),U.openPartialSession(t)}}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"session-detail"},t._l(t.session.windows,(function(s){return e("div",{key:s.key,staticClass:"window"},[t.session.windows.length>1?e("div",{staticClass:"window-label",on:{click:function(e){return e.stopPropagation(),t.openPartialSession(s)}}},[t._v("Window")]):t._e(),t._l(s.tabsAndGroups,(function(s){return[s.type===t.TabOrGroupType.Group?e("div",{key:s.key,staticClass:"group",style:{"--tab-group-color":`var(--tab-group-color-${s.color})`}},[e("div",{staticClass:"group-label",on:{click:function(e){return e.stopPropagation(),t.openPartialSession(s)}}},[t._v(t._s(s.title||"Tab group"))]),t._l(s.tabs,(function(s){return e("session-detail-tab-item",{key:s.key,attrs:{tab:s},nativeOn:{click:function(e){return e.stopPropagation(),t.openPartialSession(s)}}})}))],2):s.type===t.TabOrGroupType.Tab?e("session-detail-tab-item",{key:s.key,attrs:{tab:s},nativeOn:{click:function(e){return e.stopPropagation(),t.openPartialSession(s)}}}):t._e()]}))],2)})),0)}),[],!1,null,"831259f4").exports,W=new T({feature:"tab stash"}),z=new k("tab.tabStash.error");const K=C({name:"TabsApp",components:{AppViewSwitchDynamic:e,AppPopup:s,AppHeader:i,AppLoading:o,AppView:n,AppEmpty:a,AppConfirmCancel:r,BaseDropdown:l,BaseDropdownOption:c,BaseItemList:p,SessionListItem:H,AppActionBanner:$,BaseDropdownDivider:V,SessionDetail:q,AppHeaderControl:O,SessionConfirmDelete:M},mixins:[B],inject:["viewStateStore"],provide(){return{itemStore:this.tabsStore}},setup:()=>({tabsStore:g(),loadingTimeout:null}),data:()=>({loadingStateActive:!1,deleteConfirmationOpen:!1,hasPartialPermissions:!1}),computed:{sessions(){return this.tabsStore.getItems},empty(){return this.tabsStore.loaded&&!this.sessions.length},activeViewId(){return this.viewStateStore.activeViewId},activeView(){return this.viewStateStore.activeView},listViewActive(){return this.activeViewId===h.List},detailViewActive(){return this.activeViewId===h.Detail},isPlusDegraded:()=>m.conditionalFeatures.featureEnabled("tab-stash-degraded"),activeSession(){return this.sessions.find((t=>t.id===this.tabsStore.activeItemId))},deleteAllProps(){return{title:"Are you sure you want to delete all stashed sessions?",description:this.sessions.length+" session"+(this.sessions.length>1?"s":""),confirm:this.deleteAllSessions,confirmText:"Delete session"+(this.sessions.length>1?"s":""),cancel:this.closeDeleteConfirmation,cancelText:"Keep session"+(this.sessions.length>1?"s":"")}}},watch:{"tabsStore.loaded"(t){t&&(clearTimeout(this.loadingTimeout),this.loadingStateActive=!1)},listViewActive(t){t&&this.closeDeleteConfirmation()}},created(){this.tabsStore.loaded||(this.loadingTimeout=setTimeout((()=>{this.loadingStateActive=!0}),500),this.tabsStore.refresh()),A()&&"sessions"in chrome&&!("tabGroups"in chrome)&&(this.hasPartialPermissions=!0)},methods:{openHelpArticle(){window.open(j,"_blank")},closePopup(){this.viewStateStore.togglePopup(!1)},openDeleteConfirmation(){this.deleteConfirmationOpen=!0},closeDeleteConfirmation(){this.deleteConfirmationOpen=!1},async stashSession(){if(!(this.$plus||E.currentValue&&0===this.sessions.length))return this.showUpsell();try{const e=await this.tabsStore.stashSession();if(!e)return;if(0===e.windows.length)return void this.showFlashMessage({icon:t,message:y.ERROR_NO_OTHER_TABS,id:this.flashMessageId});W.capture("stash tabs",{tab_count:e.totalTabCount,window_count:e.windows.length}),this.showFlashMessage({icon:t,message:e.totalTabCount.toString()+" tab"+(e.totalTabCount>1?"s":"")+y.SUCCESSFUL_STASH_PARTIAL})}catch(e){console.error(e),z.error("Tab Stash: stash session error",e),this.showFlashMessage({error:!0,message:y.ERROR_STASH})}},restoreLastSession(){this.empty||this.restoreSession(this.sessions[0])},async restoreSession(e){try{if(!(await this.tabsStore.restoreSession(e)))return;W.capture("restore tabs",{tab_count:e.totalTabCount,window_count:e.windows.length}),this.showFlashMessage({icon:t,message:e.displayName+y.SUCCESSFUL_RESTORE_PARTIAL}),this.detailViewActive&&this.switchViewToList()}catch(s){console.error(s),s.sessionId=e.id,z.error("Tab Stash: restore session error",s),this.showFlashMessage({error:!0,message:y.ERROR_RESTORE})}},async deleteAllSessions(){var t;const e=await Promise.allSettled(this.sessions.map((t=>this.tabsStore.delete(t.id))));null==(t=this.$refs.confirmationDropdown)||t.closeDropdown();const s=e.filter((t=>"rejected"===t.status));0===s.length?this.showFlashMessage({message:y.SUCCESSFUL_ALL_DELETE}):(z.error("Tab Stash: delete all sessions error",{errors:s.map((t=>t.reason))}),this.showFlashMessage({error:!0,message:y.ERROR_ALL_DELETE}))},async deleteSession(e){try{await this.tabsStore.delete(e.id),this.showFlashMessage({icon:t,message:e.displayName+y.DELETE_PARTIAL}),this.detailViewActive&&this.switchViewToList()}catch(s){z.error("Tab Stash: delete session error",s),this.showFlashMessage({error:!0,message:y.ERROR_DELETE})}},switchViewToList(){this.viewStateStore.setActiveView(h.List),this.tabsStore.activeItemId=""},showUpsell(){m.cmd("modal.open","UPSELL_TAB_STASH",{eventSource:"dash"})},async ensurePermissions(){await this.tabsStore.ensurePermissions()&&(this.hasPartialPermissions=!1)}}},(function(){var e=this,s=e._self._c;return s("app-popup",{attrs:{position:"bottom-right",region:"top-left","data-test":"tab-stash-app",width:320,focused:e.viewStateStore.focused},on:{close:e.closePopup},nativeOn:{click:function(t){return e.viewStateStore.focus()}}},[s("transition",{attrs:{name:"fade",mode:"out-in",duration:"100"}},[e.loadingStateActive?s("app-loading"):e.tabsStore.loaded?s("div",{staticClass:"app-content"},[s("app-view-switch-dynamic",{attrs:{"order-key":e.activeView.order}},[e.listViewActive?s("app-view",{staticClass:"list session-list",attrs:{"data-test":"tabs-list-view"},scopedSlots:e._u([{key:"header",fn:function(){return[[s("app-header",{scopedSlots:e._u([{key:"left",fn:function(){return[s("inline-svg",{staticClass:"icon app-header-icon",attrs:{src:t}}),s("span",{staticClass:"app-header-name"},[e._v("Tab Stash")])]},proxy:!0},{key:"right",fn:function(){return[s("base-dropdown",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.closeDeleteConfirmation,expression:"closeDeleteConfirmation"}],ref:"settingsDropdown",attrs:{"container-class":"app","data-test":"list-header-dropdown"},on:{toggle:e.closeDeleteConfirmation}},[e.deleteConfirmationOpen?[s("div",[s("app-confirm-cancel",e._b({attrs:{"data-test":"confirm-delete-all"}},"app-confirm-cancel",e.deleteAllProps,!1))],1)]:[e.empty?e._e():s("base-dropdown-option",{staticClass:"delete",attrs:{"data-test":"delete-all"},on:{click:e.openDeleteConfirmation}},[s("inline-svg",{staticClass:"icon icon-trash",attrs:{src:x}}),s("span",{staticClass:"text"},[e._v("Delete all sessions")])],1),e.empty?e._e():s("base-dropdown-divider"),s("base-dropdown-option",{attrs:{"data-test":"tabs-onboarding"},on:{click:e.openHelpArticle}},[s("inline-svg",{staticClass:"icon icon-help",attrs:{src:I}}),s("span",{staticClass:"text"},[e._v("Help")])],1)]],2)]},proxy:!0}],null,!1,3750885127)}),e.empty?e._e():s("div",{staticClass:"button-row"},[e.isPlusDegraded?e._e():s("div",{staticClass:"button",attrs:{"data-test":"save-tabs"},on:{click:e.stashSession}},[e._v("Stash tabs")]),s("div",{staticClass:"button button-neutral",attrs:{"data-test":"restore-last"},on:{click:e.restoreLastSession}},[e._v("Restore last session")])]),e.isPlusDegraded?s("app-action-banner",{attrs:{"action-text":"Renew",text:"Plus subscription expired."},on:{action:e.showUpsell}}):e.hasPartialPermissions?s("app-action-banner",{attrs:{"action-text":"Grant permissions",text:"We need new permissions to handle tab groups"},on:{action:e.ensurePermissions}}):e._e()]]},proxy:!0},{key:"body",fn:function(){return[e.empty?s("app-empty",{attrs:{title:"Stash your tabs for later\nso you can focus","button-text":"Stash open tabs"},on:{buttonClick:e.stashSession}}):[s("base-item-list",e._l(e.sessions,(function(t){return s("session-list-item",{key:t.id,attrs:{session:t},on:{restore:function(s){return e.restoreSession(t)},delete:function(s){return e.deleteSession(t)}}})})),1)]]},proxy:!0}],null,!1,1025487318)}):e.detailViewActive&&e.activeSession?s("app-view",{attrs:{"data-test":"tabs-detail-view"},scopedSlots:e._u([{key:"header",fn:function(){return[[s("app-header",{scopedSlots:e._u([{key:"left",fn:function(){return[s("app-header-control",{on:{click:e.switchViewToList}},[s("inline-svg",{staticClass:"icon icon-tabs",attrs:{src:F}})],1)]},proxy:!0},{key:"center",fn:function(){return[s("div",{staticClass:"detail-header-title",attrs:{"data-test":"detail-header"}},[e._v(e._s(e.activeSession.displayName))])]},proxy:!0}])}),s("div",{staticClass:"button-row"},[s("div",{staticClass:"button",attrs:{"data-test":"restore-session"},on:{click:function(t){return e.restoreSession(e.activeSession)}}},[e._v("Restore session")]),s("base-dropdown",{ref:"detailDeleteDropdown",attrs:{"container-class":"app","data-test":"confirm-delete"},scopedSlots:e._u([{key:"toggle",fn:function(){return[s("div",{staticClass:"button button-neutral",attrs:{"data-test":"delete-session"}},[e._v("Delete session")])]},proxy:!0}])},[s("session-confirm-delete",{attrs:{session:e.activeSession},on:{cancel:()=>{var t;return null==(t=e.$refs.detailDeleteDropdown)?void 0:t.closeDropdown()},delete:()=>e.deleteSession(e.activeSession)}})],1)],1)]]},proxy:!0},{key:"body",fn:function(){return[s("session-detail",{attrs:{session:e.activeSession,"data-test":"confirm-delete"}})]},proxy:!0}])}):e._e()],1)],1):e._e()],1)],1)}),[],!1,null,"c93de776").exports;export{K as default};