const __vite__fileDeps=["assets/js/QuickNav-CGdUOv2k.js","assets/js/QuickNavOptionsList-B0pawPd9.js","assets/js/promisifiedChrome-CheD9WtZ.js","assets/js/timestampDb-sTUCijT1.js","assets/js/Logger-Dqn8sDPg.js","assets/js/environmentVariables-Cy83xda0.js","assets/js/ResizeSensor-CXS_pGRc.js","assets/js/preload-helper-D7CfCCEq.js","assets/js/string-KTo4Qfpe.js","assets/css/QuickNavOptionsList-BDWyBtxL.css","assets/js/allComponentsMounted-C3UsG_cA.js","assets/js/switch-EuBTQVVE.js","assets/css/QuickNav-CNmjNfzP.css","assets/js/Time-CQ4IeQ4b.js","assets/css/Time-BMExzPJ1.css","assets/js/PomodoroDropdown-RxEO7W9i.js","assets/js/Dropdown-CPB6qe0h.js","assets/js/icon-ellipsis-D3jS4u3x.js","assets/css/Dropdown-BcLAxJWG.css","assets/js/DropdownOption-CokACERR.js","assets/js/ToastMenuLegacy-Do47o3MR.js","assets/css/ToastMenuLegacy-DzMwE8K6.css","assets/js/BaseIcon-CACrCBea.js","assets/js/arrow-B0GpGOd-.js","assets/js/icon-weather-reset-D7qA-OAP.js","assets/js/icon-settings-Bycjf8-G.js","assets/js/dashboard-CF_jRhAY.js","assets/js/main--IJuvtTE.js","assets/js/localStorage-B4mFdj8F.js","assets/js/migrateLegacyUserMessageHandler-CU6TUnqH.js","assets/css/dashboard-C0DDMXTO.css","assets/js/icon-chrome-BdhFuvxf.js","assets/js/icon-back-arrow-CiRQJ6G-.js","assets/js/icon-back-D_TFrgyJ.js","assets/js/icon-check-Vc9B11BJ.js","assets/js/icon-circle-D-D5U4qS.js","assets/js/icon-close-BUGl_M7j.js","assets/js/icon-cog-BFr_Pva7.js","assets/js/icon-skip-BOkC5L0N.js","assets/js/icon-trash-DFxJwJNo.js","assets/js/icon-down-BiHbKN-t.js","assets/js/icon-edit-CixeXNYx.js","assets/js/icon-error-state-BKQhfBCj.js","assets/js/icon-heart-v5O7C6eS.js","assets/js/icon-hide-NFfBhfBx.js","assets/js/icon-key-BPNRipb3.js","assets/js/icon-lock-B0ekkj2F.js","assets/js/icon-next-B4hjdiAA.js","assets/js/icon-photo-BrwqV1T0.js","assets/js/icon-pin-BHeOuzvO.js","assets/js/icon-plus-D4YOesIc.js","assets/js/icon-profile-B_XWyuTb.js","assets/js/icon-x-qUCmf2CW.js","assets/js/icon-skip-intro-BUi8b3Ak.js","assets/js/icon-tooltip-CN09iXOB.js","assets/js/icon-visible-on-CM3kpcFN.js","assets/js/icon-x-caret-half-CZtcH_PM.js","assets/js/star-rating-CNohptmf.js","assets/js/pomodoro-circle-Dx_GWql1.js","assets/js/star-KworSO8x.js","assets/js/thanks-DfYnO-qW.js","assets/js/add-COIuonao.js","assets/js/google-DKPAcOmk.js","assets/js/arrow-up-1QPpu78M.js","assets/js/chevron-down-DdbU9YAr.js","assets/js/pomodoro-DvfTwCi0.js","assets/js/clocks-DjzskNOU.js","assets/js/close-D7GCNZxm.js","assets/js/search-DCqlmJx6.js","assets/js/folder-CwWTWsnJ.js","assets/js/focus-mode-09pIyYAW.js","assets/js/storage-YYEO5TB5.js","assets/js/icon-confetti-Dz2LojDe.js","assets/js/wind-D3u4taeq.js","assets/js/sparks-CAw9b6ob.js","assets/js/secure-B8YP-AML.js","assets/js/icon-percent-schedule-CA5EI9b7.js","assets/js/icon-trello-BoqqWb7o.js","assets/js/icon-clean-rFsPxTtp.js","assets/js/icon-more-lists-Dg-hN7s6.js","assets/js/icon-more-fonts-CcfOY0t4.js","assets/js/icon-focus-stats-keERwXFt.js","assets/js/icon-easy-access-BZifTR0C.js","assets/js/icon-top-of-mind-B6EhbCcK.js","assets/js/icon-flow-5QqmGIWX.js","assets/js/icon-focused-JrsBbR-K.js","assets/js/icon-weather-extra-ufLpT_SX.js","assets/js/icon-spiral-gh4hwZDD.js","assets/js/icon-happy-place-D1z6CJgM.js","assets/js/icon-time-sensitive-CP2L3maw.js","assets/js/icon-hourly-CdMmiQZT.js","assets/js/icon-infinity-D4yMRoAd.js","assets/js/icon-integrations-Y-aXZTst.js","assets/js/icon-kanban-Dodqg7y-.js","assets/js/icon-personalize-photos-D2M4lLlt.js","assets/js/icon-personalize-n8qjJGGA.js","assets/js/icon-photo-match-C2EChNEK.js","assets/js/icon-random-375DbcwF.js","assets/js/icon-timezones-DGZoTtaT.js","assets/js/icon-simplify-BRUtLJYp.js","assets/js/icon-skip-Bd6EhalI.js","assets/js/icon-sync-DIH26Y9h.js","assets/css/BaseIcon-BlT7Qz-y.css","assets/css/PomodoroDropdown-CUclz5wB.css","assets/js/Focus-CV7H0iZA.js","assets/js/focusCollection-BcWYAnwr.js","assets/js/VueBase-CjPGMLuv.js","assets/js/index-CJJH83pl.js","assets/js/itemModelMixin-BHakSWl-.js","assets/js/reactiveCustomization-CrL2eTrh.js","assets/js/namesMixin-EAvqmdCw.js","assets/js/MobileBlur-B2s9dLKD.js","assets/js/showAnyway-CbfR58eh.js","assets/js/centerBelowMetadata-Bp2C4PFe.js","assets/js/flashMessageMixin-BWjGkbzu.js","assets/js/globalKeyEventManager-KbJZwtdf.js","assets/js/constants-D-OQQ8lR.js","assets/css/Focus-BnI0exzS.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as t}from"./preload-helper-D7CfCCEq.js";import{a as e}from"./allComponentsMounted-C3UsG_cA.js";import{s as o}from"./showAnyway-CbfR58eh.js";import{c as i}from"./clockMetadata-DW6lmI6A.js";import{T as s}from"./dashboard-CF_jRhAY.js";import r from"./focusCollection-BcWYAnwr.js";import{n as a,i as n,e as c,u as d,c as u,b as l,w as h,p,A as g}from"./promisifiedChrome-CheD9WtZ.js";import{usePomodoroCompletedStore as f}from"./pomodoroCompleted-Bt4M3o49.js";import{w as T}from"./onboardingStepCollection-CDnR_iEN.js";import{b as y}from"./ResizeSensor-CXS_pGRc.js";import{_ as S}from"./pomodoro-circle-Dx_GWql1.js";import"./VueBase-CjPGMLuv.js";import"./index-CJJH83pl.js";import"./pomodoro-DvfTwCi0.js";import"./main--IJuvtTE.js";import"./localStorage-B4mFdj8F.js";import"./Logger-Dqn8sDPg.js";import"./environmentVariables-Cy83xda0.js";import"./migrateLegacyUserMessageHandler-CU6TUnqH.js";import"./timestampDb-sTUCijT1.js";import"./itemModelMixin-BHakSWl-.js";import"./reactiveCustomization-CrL2eTrh.js";import"./namesMixin-EAvqmdCw.js";import"./string-KTo4Qfpe.js";import"./itemDataServiceMixins-R3DPkCUM.js";import"./focusModeHelpers-Cqkll3ju.js";import"./arrow-B0GpGOd-.js";import"./LinksService-BV1Om5gI.js";import"./icon-next-B4hjdiAA.js";import"./authService-B5VliZ3K.js";import"./SubscriptionSummary-Bb_CwKvU.js";import"./icon-confetti-Dz2LojDe.js";import"./siteBlockerGroups-1V1XRNi6.js";import"./constants-D-OQQ8lR.js";import"./compareObjects-BF7sSNEf.js";const w={focus:["Time to focus.","Focus time."],rest:["Time for a break.","Break time."]};class v{constructor(t,e){this.lockName=t,this.isLeader=!1;const o=function(t,e){let o;const i=new Promise((t=>{o=t}));return navigator.locks.request(t,(()=>(e(),i))),()=>o()}(t,(()=>{this.isLeader=!0,null==e||e()}));this.stepDown=()=>{this.isLeader=!1,o()}}}var b=(t=>(t.FocusEnd="PomodoroTimerEnd_focus",t.FocusAutoplayEnd="PomodoroTimerEnd_focus_autoplay",t.BreakEnd="PomodoroTimerEnd_rest",t.BreakAutoplayEnd="PomodoroTimerEnd_rest_autoplay",t))(b||{});const k=Object.values(b),P={PomodoroTimerEnd_focus:{exclusiveWith:k.filter((t=>"PomodoroTimerEnd_focus"!==t)),id:"PomodoroTimerEnd_focus",notification:{title:"ðŸ‘ Nicely done! Time for a break.",message:"Take {{dynamic}} minutes to recharge.\nClick to start break.",buttons:[{title:"â–¶ï¸ Start Break"},{title:"â³ Focus +10min"}],iconUrl:"/img/app/icon-128.png",type:"basic",priority:2},type:"pomodoro"},PomodoroTimerEnd_focus_autoplay:{exclusiveWith:k.filter((t=>"PomodoroTimerEnd_focus_autoplay"!==t)),id:"PomodoroTimerEnd_focus_autoplay",notification:{title:"ðŸ‘ Nicely done! Time for a break.",message:"Take {{dynamic}} minutes to recharge.\nYour break starts now.",buttons:[{title:"â³ Focus +10min"},{title:"â¸ï¸ Pause Break"}],iconUrl:"/img/app/icon-128.png",type:"basic",priority:2},type:"pomodoro"},PomodoroTimerEnd_rest:{exclusiveWith:k.filter((t=>"PomodoroTimerEnd_rest"!==t)),id:"PomodoroTimerEnd_rest",notification:{title:"ðŸ§  Resume focus",message:"Try to focus during the next {{dynamic}} minutes. Click to start timer.",buttons:[{title:"â–¶ï¸ Start Focus"},{title:"â³ Break +10min"}],iconUrl:"/img/app/icon-128.png",type:"basic",priority:2},type:"pomodoro"},PomodoroTimerEnd_rest_autoplay:{exclusiveWith:k.filter((t=>"PomodoroTimerEnd_rest_autoplay"!==t)),id:"PomodoroTimerEnd_rest_autoplay",notification:{title:"ðŸ§  Focus timer started",message:"Try to focus during the next {{dynamic}} minutes, starting now.",buttons:[{title:"â³ Break +10min"},{title:"â¸ï¸ Pause Focus"}],iconUrl:"/img/app/icon-128.png",type:"basic",priority:2},type:"pomodoro"}};var F=(t=>(t.StartBreak="startBreak",t.PauseBreak="pauseBreak",t.BreakPlus10="breakPlus10",t.StartFocus="startFocus",t.PauseFocus="pauseFocus",t.FocusPlus10="focusPlus10",t))(F||{});const C={PomodoroTimerEnd_focus:"startBreak",PomodoroTimerEnd_focus_0:"startBreak",PomodoroTimerEnd_focus_1:"focusPlus10",PomodoroTimerEnd_focus_autoplay:"",PomodoroTimerEnd_focus_autoplay_0:"focusPlus10",PomodoroTimerEnd_focus_autoplay_1:"pauseBreak",PomodoroTimerEnd_rest:"startFocus",PomodoroTimerEnd_rest_0:"startFocus",PomodoroTimerEnd_rest_1:"breakPlus10",PomodoroTimerEnd_rest_autoplay:"",PomodoroTimerEnd_rest_autoplay_0:"breakPlus10",PomodoroTimerEnd_rest_autoplay_1:"pauseFocus"},_=new g({feature:"pomodoro",is_paid_event:!0}),N={Focus:"focus",FocusPlusTen:"focusPlusTen",Break:"rest",BreakPlusTen:"restPlusTen"},E={name:"Pomodoro",components:{ThreeColLayout:s,QuickNav:()=>t((()=>import("./QuickNav-CGdUOv2k.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),PomodoroTime:()=>t((()=>import("./Time-CQ4IeQ4b.js")),__vite__mapDeps([13,10,2,3,4,5,6,7,8,14])),PomodoroDropdown:()=>t((()=>import("./PomodoroDropdown-RxEO7W9i.js")),__vite__mapDeps([15,16,17,2,3,4,5,6,7,8,18,19,20,21,1,9,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,11,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103])),Focus:()=>t((()=>import("./Focus-CV7H0iZA.js")),__vite__mapDeps([104,7,72,105,106,6,5,26,27,2,3,4,8,28,29,30,107,108,109,110,111,112,113,68,10,114,115,116,117]))},mixins:[e],props:{optionsOnly:{type:Boolean,default:!1},quickNavVisible:{type:Boolean,default:!0}},setup:()=>({pomodoroCompletedStore:f(),showAnyway:o,centerOptions:i,tabElection:null,TimerIds:N}),data:()=>({timers:{focus:{name:"Focus",minutes:25},rest:{name:"Break",minutes:5}},activeTimerId:N.Focus,started:!1,timeRemaining:0,expectedTimerEnd:0,timer:null,sounds:!0,browserNotifications:!1,autoplay:!1,hideSeconds:!1}),computed:{activeTimer(){const t={[N.FocusPlusTen]:{name:"Focus",minutes:10},[N.BreakPlusTen]:{name:"Break",minutes:10}};return{...this.timers,...t}[this.activeTimerId]},startMessage(){return m.utils.getRandomItem(w[this.anyFocusTimerActive?N.Focus:N.Break])},dashProgress(){const t=60*this.activeTimer.minutes;return Math.min(this.timeRemaining,t)/t*212+"%"},message(){return this.started||0!==this.timeRemaining?this.started?this.activeTimer.name:this.startMessage:"Done!"},showFocusComponent(){return this.anyFocusTimerActive&&0!==this.timeRemaining},messageFade(){return this.started?"fade-fast":"fade"},completedStats(){return this.pomodoroCompletedStore.completedStats},hours(){return this.hideSeconds?Math.trunc(this.timeRemaining/3600).toString():m.utils.twoDigit(Math.trunc(this.timeRemaining/3600))},minutes(){return this.hideSeconds?Math.trunc(this.timeRemaining/60%60).toString():m.utils.twoDigit(Math.trunc(this.timeRemaining/60%60))},seconds(){return m.utils.twoDigit(this.timeRemaining%60)},timeString(){return this.hideSeconds?this.hours>0?`${this.hours}h ${this.minutes}m`:`${this.minutes}m`:this.hours>0?`${this.hours}:${this.minutes}:${this.seconds}`:`${this.minutes}:${this.seconds}`},documentTitle(){var t;const e=null==(t=r.activeFocus)?void 0:t.focus;return`${this.timeString} Â· ${e&&!e.completed&&this.anyFocusTimerActive?e:this.activeTimer.name}`},isSafari:n,focusPlus10Visible(){return this.activeTimerId===N.Break&&!this.started&&this.timeRemaining===60*this.timers.rest.minutes&&this.$plus},currentFocusedMinutes(){if(this.anyBreakTimerActive||0===this.timeRemaining)return 0;let t=60*Number(this.activeTimer.minutes);const e=this.started?this.expectedTimerEnd-m.models.date.get("seconds").getTime():1e3*this.timeRemaining,o=Math.max(Math.min(e/1e3,t),0);return Math.floor((t-o)/60)},anyFocusTimerActive(){return[N.Focus,N.FocusPlusTen].includes(this.activeTimerId)},anyBreakTimerActive(){return[N.Break,N.BreakPlusTen].includes(this.activeTimerId)},belowButtonText(){return this.started?"Pause":this.timeRemaining<60*Number(this.activeTimer.minutes)?"Resume":"Start"}},watch:{sounds(){this.saveSettingsToCustomization("sounds",this.sounds)},browserNotifications(){this.saveSettingsToCustomization("browserNotifications",this.browserNotifications),this.started&&this.syncPendingNotification()},autoplay(){this.saveSettingsToCustomization("autoplay",this.autoplay)},hideSeconds(){this.saveSettingsToCustomization("hideSeconds",this.hideSeconds)},documentTitle(t){document.title=t},currentFocusedMinutes(){this.pomodoroCompletedStore.currentSessionLength=this.currentFocusedMinutes}},mounted(){this.optionsOnly||(this.autoStartFocusTimer&&(this.sounds&&!this.optionsOnly&&window.pomodoroSounds.start.play(),this.start()),this.$body=$("body"),this.$body.addClass("has-pomodoro"),c.$on("notificationClick",this.onNotificationClick),T().then((()=>{const t=d.getParamsFromUrl();if(t.notificationClick in C&&(d.removeUrlParams("notificationClick"),this.onNotificationClick(t.notificationClick)),!n()&&this.browserNotifications){const t=u();"notifications"in t&&t.notifications.create||this.ensureNotificationPermissions()}})))},created(){m.models.customization.on("change:pomodoroSettingsStr",this.handleSettingsChange),this.settingsMigrationFromLocalToCustomization(),this.setSettingsFromCustomization(),this.optionsOnly||(this.tabElection=new v("pomodoro"),window.addEventListener("storage",this.handleStorageChangeForStartedPomodoro),m.on("newDay",this.resetToFocus),m.on("pomodoro:reset",this.resetToFocus),m.on("pomodoro:restart",this.restartTimer),m.on("pomodoro:complete",this.completeTimer),m.on("pomodoro:togglePlay",this.togglePlay),m.on("focusMode:starting",this.restartTimer),this.pomodoroCompletedStore.refresh(),window.pomodoroSounds={start:new Audio("sounds/pomo-start.mp3"),stop:new Audio("sounds/pomo-stop.mp3"),done:new Audio("sounds/pomo-done.mp3")},(()=>{if("true"===localStorage.getItem("pomodoro-running")||localStorage.getItem("pomodoro-showing")||localStorage.getItem("pomodoro-time-remaining")){if(this.started="true"===localStorage.getItem("pomodoro-running"),this.autoStartFocusTimer="true"===localStorage.getItem("pomodoro-focus-timer"),this.autoStartFocusTimer)return this.setTimer(N.Focus),void localStorage.removeItem("pomodoro-focus-timer");this.activeTimerId=localStorage.getItem("pomodoro-started")||this.activeTimerId,localStorage.getItem("pomodoro-time-remaining")?this.timeRemaining=Number(localStorage.getItem("pomodoro-time-remaining")):localStorage.getItem("pomodoro-started-expected-timer-end")&&(this.expectedTimerEnd=Number(localStorage.getItem("pomodoro-started-expected-timer-end")),isNaN(this.expectedTimerEnd)||(this.timeRemaining=Math.floor((this.expectedTimerEnd-Date.now())/1e3))),this.timeRemaining/60>Number(this.activeTimer.minutes)?(this.stop(),this.reset()):this.timeRemaining>0&&this.started?this.timeOutForCountdown():this.timeRemaining<0?(localStorage.setItem("pomodoro-running",!1),this.setTimer(this.anyFocusTimerActive?N.Break:N.Focus),this.clearStartedTimeout()):this.timeRemaining||this.setTimer(this.activeTimerId)}else this.setTimer(this.activeTimerId),this.removeAllPomodoroLocalStorageKeys()})(),localStorage.removeItem("pomodoro-reset"),m.trigger("pomodoro:created"))},destroyed(){m.models.customization.off("change:pomodoroSettingsStr",this.handleSettingsChange),this.optionsOnly||(this.tabElection.stepDown(),this.$body.removeClass("has-pomodoro"),m.off("newDay",this.resetToFocus),m.off("pomodoro:reset",this.resetToFocus),m.off("pomodoro:togglePlay",this.togglePlay),m.off("pomodoro:restart",this.restartTimer),m.off("pomodoro:complete",this.completeTimer),m.off("focusMode:starting",this.restartTimer),window.removeEventListener("storage",this.handleStorageChangeForStartedPomodoro),clearTimeout(this.timer),document.title="New Tab",this.stop(),localStorage.setItem("pomodoro-closed",!0),this.removeAllPomodoroLocalStorageKeys(),c.$off("notificationClick",this.onNotificationClick),this.pomodoroCompletedStore.currentSessionLength=0)},methods:{countdown(){this.calculateTimeRemaining(),this.timeRemaining<=0||this.timeOutForCountdown()},timeOutForCountdown(){const t=1e3-(new Date).getMilliseconds()+10;clearTimeout(this.timer),this.timer=setTimeout(this.countdown,t)},calculateTimeRemaining(){const t=Number(localStorage.getItem("pomodoro-started-expected-timer-end"));if(isNaN(t)||(this.expectedTimerEnd=t),this.timeRemaining>0&&(this.timeRemaining=Math.floor((this.expectedTimerEnd-Date.now())/1e3)),this.timeRemaining<=0)return this.isSafari?this.complete():this.completeDebounced();1===this.timeRemaining&&this.autoplay&&this.syncPendingNotification(!0)},togglePlay(){!0===this.started?(this.sounds&&!this.optionsOnly&&window.pomodoroSounds.stop.play(),this.stop()):(this.sounds&&!this.optionsOnly&&window.pomodoroSounds.start.play(),this.start())},toggleMasterPlayPause(){this.togglePlay()},completeDebounced(){clearTimeout(this.completeTimeout),this.completeTimeout=setTimeout(this.complete,100)},complete({switchAfterComplete:t=!0,playSounds:e=!0,bypassTabElection:o=!1}={}){const i=this.timeRemaining>0,s=()=>{this.clearStartedTimeout(),this.timeRemaining=0};if(o||this.tabElection&&this.tabElection.isLeader){if(this.anyFocusTimerActive&&(this.started||this.timeRemaining>0)){const t={focusMinutes:this.timeRemaining<=0?Math.floor(Number(this.timers.focus.minutes)):this.currentFocusedMinutes,dateCreated:(new Date).toISOString(),completed:(new Date).toISOString(),aggregatedEntries:1};this.pomodoroCompletedStore.loaded&&0===this.pomodoroCompletedStore.data.length&&m.trigger("pomodoro:firstSessionCompleted"),this.pomodoroCompletedStore.create(t)}s(),this.sounds&&!this.optionsOnly&&e&&window.pomodoroSounds.done.play(),this.stop(),t?this.switchTimers():this.setTimer(this.activeTimerId),_.capture("pomodoro complete",{period:this.activeTimerId}),i&&this.deleteNotification()}else s()},switchTimers(){const t=this.autoplay;setTimeout((()=>{this.setTimer(this.anyFocusTimerActive?N.Break:N.Focus),t&&this.start()}),1500)},reset(){this.setCountdownTimer(),localStorage.removeItem("pomodoro-started-expected-timer-end"),localStorage.removeItem("pomodoro-time-remaining"),this.stop(),localStorage.setItem("pomodoro-reset",!0)},resetToFocus(){this.reset(),this.setTimer(N.Focus),this.setCountdownTimer()},start(){this.clearStartedTimeout(),this.started=!0,this.expectedTimerEnd=Date.now()+1e3*this.timeRemaining,localStorage.removeItem("pomodoro-time-remaining"),localStorage.setItem("pomodoro-running",!0),localStorage.setItem("pomodoro-started-expected-timer-end",this.expectedTimerEnd),this.timeOutForCountdown(),_.capture("pomodoro start",{period:this.activeTimerId}),this.syncPendingNotification(!1),m.trigger("pomodoro:started")},stop(){this.clearStartedTimeout(),localStorage.setItem("pomodoro-running",!1),localStorage.setItem("pomodoro-time-remaining",this.timeRemaining),_.capture("pomodoro stop",{period:this.activeTimerId}),this.timeRemaining>1&&this.deleteNotification(),m.trigger("pomodoro:stopped")},setTimer(t){this.started&&this.stop(),this.activeTimerId=t,localStorage.setItem("pomodoro-started",this.activeTimerId),this.setCountdownTimer()},clickTimer(t){this.setTimer(t),_.capture("period change",{new_value:t})},setCountdownTimer(){this.timeRemaining=60*this.activeTimer.minutes},setTimerDuration(t,e){this.saveSettingsToCustomization(`${t}Duration`,e),_.capture("duration change",{period:t,new_value:e})},setTimeRemainingAfterUpdate(t,e,o){if(this.optionsOnly)return;if(this.activeTimerId!==t)return;const i=60*(o-e),s=this.timeRemaining;i<0&&s<0-i?this.complete():(this.timeRemaining+=i,this.expectedTimerEnd+=1e3*i,localStorage.setItem("pomodoro-started-expected-timer-end",this.expectedTimerEnd))},setTimerWhenNotStarted(t){this.started||this.activeTimerId!==t||(this.timeRemaining=60*this.activeTimer.minutes)},closePomodoro(){this.$emit("pomodoro-show",!1)},handleStorageChangeForStartedPomodoro(t){switch(t.key){case"pomodoro-running":if(null===t.newValue)return;"true"===t.newValue?(this.clearStartedTimeout(),this.started=!0,this.expectedTimerEnd=Date.now()+1e3*this.timeRemaining,this.timeOutForCountdown()):this.clearStartedTimeout();break;case"pomodoro-reset":if(null===t.newValue)return;this.setCountdownTimer(),this.clearStartedTimeout(),localStorage.removeItem("pomodoro-reset");break;case"pomodoro-closed":if(null===t.newValue)return;document.title="New Tab",this.removeAllPomodoroLocalStorageKeys(),this.$emit("pomodoro-show",!1);break;case"pomodoro-complete":if(null===t.newValue)return;this.timeRemaining=0,this.stop(),this.switchTimers(),localStorage.removeItem("pomodoro-complete");break;case"pomodoro-started":if(null===t.newValue)return;this.setTimer(t.newValue)}},handleSettingsChange(){let t=this.getPomodoroSettingsFromCustomization();if(!t)return;const e=void 0===t.sounds||t.sounds;if(e!==this.sounds&&(this.sounds=e),t.autoplay!==this.autoplay&&(this.autoplay=t.autoplay),t.hideSeconds!==this.hideSeconds&&(this.hideSeconds=t.hideSeconds),t.browserNotifications!==this.browserNotifications&&(this.browserNotifications=t.browserNotifications),Number(t.focusDuration)!==Number(this.timers.focus.minutes)){const e=this.timers.focus.minutes;this.timers.focus.minutes=Number(t.focusDuration),this.setTimeRemainingAfterUpdate(N.Focus,e,Number(t.focusDuration))}if(Number(t.restDuration)!==Number(this.timers.rest.minutes)){const e=this.timers.rest.minutes;this.timers.rest.minutes=Number(t.restDuration),this.setTimeRemainingAfterUpdate(N.Break,e,Number(t.restDuration))}this.started&&this.syncPendingNotification()},clearStartedTimeout(){this.started=!1,clearTimeout(this.timer)},removeAllPomodoroLocalStorageKeys(){["pomodoro-reset","pomodoro-running","pomodoro-closed","pomodoro-started-expected-timer-end","pomodoro-current-focus","pomodoro-complete","pomodoro-focus-timer"].forEach((t=>{localStorage.removeItem(t)}))},switchClock(t){if("clock"===t)this.closePomodoro()},getPomodoroSettingsFromCustomization(){const t=m.models.customization.get("pomodoroSettingsStr");return t&&JSON.parse(t)},setSettingsFromCustomization(){let t=this.getPomodoroSettingsFromCustomization();t&&(this.timers.focus.minutes=Number(t.focusDuration),this.timers.rest.minutes=Number(t.restDuration),this.sounds=void 0===t.sounds||t.sounds,this.autoplay=t.autoplay,this.hideSeconds=t.hideSeconds,this.browserNotifications=t.browserNotifications)},saveSettingsToCustomization(t,e){let o=this.getPomodoroSettingsFromCustomization();o&&(o[t]=e,m.models.customization.save("pomodoroSettingsStr",JSON.stringify(o)))},settingsMigrationFromLocalToCustomization(){let t={"pomodoro-focus-duration":"focusDuration","pomodoro-rest-duration":"restDuration","pomodoro-autoplay":"autoplay"};Object.keys(t).forEach((e=>{localStorage.getItem(e)&&(this.saveSettingsToCustomization(t[e],localStorage.getItem(e)),localStorage.removeItem(e))}))},completeTimer({switchAfterComplete:t=!0}={}){this.optionsOnly?m.trigger("pomodoro:complete",{switchAfterComplete:t}):(this.complete({switchAfterComplete:t,bypassTabElection:!0}),localStorage.setItem("pomodoro-complete",!0))},restartTimer(){this.optionsOnly?m.trigger("pomodoro:restart"):this.currentFocusedMinutes>0?this.complete({switchAfterComplete:!1,playSounds:!1,bypassTabElection:!0}):this.reset()},addTenMinutes(t=N.Focus){this.setTimerDuration(t,Number(this.timers[t].minutes)+10)},showToastMenu(){this.$e.$emit("pomodoro:toggleDropdown",!0)},async extendFocusAfterEnd(){this.setTimer(N.FocusPlusTen),await d.delay(500),this.toggleMasterPlayPause()},async extendBreakAfterEnd(){this.setTimer(N.BreakPlusTen),await d.delay(500),this.toggleMasterPlayPause()},deleteNotification(){l.sendMessage({handler:"deleteNotification",args:[k],timeout:4e4})},syncPendingNotification(t){if(this.browserNotifications){const e=`PomodoroTimerEnd_${this.anyFocusTimerActive?N.Focus:N.Break}${t?"_autoplay":""}`,o=this.timers[this.anyFocusTimerActive?"rest":"focus"].minutes,i=structuredClone(P[e]);i.notification.message=i.notification.message.replace("{{dynamic}}",o),i.time=this.expectedTimerEnd,d.isFirefox()&&delete i.notification.buttons,l.sendMessage({handler:"createOrUpdateNotification",args:[i],timeout:4e4})}else l.sendMessage({handler:"deleteNotificationsOfType",args:["pomodoro"]})},onNotificationClick(t){const e=C[t];if(this.tabElection.isLeader)switch(e){case F.StartBreak:this.anyBreakTimerActive||this.setTimer(N.Break),this.started||this.start();break;case F.PauseBreak:this.anyBreakTimerActive&&this.stop();break;case F.BreakPlus10:this.started&&this.anyFocusTimerActive&&this.stop(),this.extendBreakAfterEnd();break;case F.StartFocus:this.anyFocusTimerActive||this.setTimer(N.Focus),this.started||this.start();break;case F.PauseFocus:this.started&&this.anyFocusTimerActive&&this.stop();break;case F.FocusPlus10:this.started&&this.anyBreakTimerActive&&this.stop(),this.extendFocusAfterEnd()}},async ensureNotificationPermissions(){const t=["notifications"];h()||t.push("alarms");const e=await new Promise((e=>{p.permissions.contains({permissions:t}).then((o=>{o?e(!0):m.cmd("modal.open","PERMISSION_REQUEST",{widgetName:"Pomodoro",permissionExplanation:"To show browser notifications",permissions:{permissions:t},resolve:e})}))}));this.browserNotifications=e}}},I=()=>{y(((t,e)=>({"2af69fa3":t.dashProgress})))},R=E.setup;E.setup=R?(t,e)=>(I(),R(t,e)):I;const x=a(E,(function(){var t=this,e=t._self._c;return t.optionsOnly?e("pomodoro-dropdown",{attrs:{"always-open":!0,timers:t.timers,sounds:t.sounds,"browser-notifications":t.browserNotifications,autoplay:t.autoplay,"hide-seconds":t.hideSeconds,"completed-stats":t.completedStats,options:t.centerOptions},on:{"update:sounds":function(e){t.sounds=e},"update:browserNotifications":function(e){t.browserNotifications=e},"update:browser-notifications":function(e){t.browserNotifications=e},"update:autoplay":function(e){t.autoplay=e},"update:hideSeconds":function(e){t.hideSeconds=e},"update:hide-seconds":function(e){t.hideSeconds=e},"update:timer":t.setTimerDuration,"complete-timer":t.completeTimer,"restart-timer":t.restartTimer,"add-ten-minutes":t.addTenMinutes,"switch-clock":t.switchClock,ensureNotificationPermissions:t.ensureNotificationPermissions}}):e("section",{staticClass:"clock pomodoro app-container has-dash-icon",class:{running:t.started,"show-anyway":t.showAnyway.includes("pomodoro")},attrs:{"data-show-anyway":"pomodoro","data-test":"pomodoro"}},[e("div",{staticClass:"circle"},[e("div",{staticClass:"circle-inner"},[e("div",{staticClass:"circle-background"}),e("div",{staticClass:"circle-foreground"}),e("inline-svg",{staticClass:"circle-svg",attrs:{src:S}})],1)]),e("div",{staticClass:"above"},[e("nav",{staticClass:"modes"},[e("div",{staticClass:"mode",class:{active:t.anyFocusTimerActive},attrs:{"data-test":"focus-btn"},on:{click:function(e){return t.clickTimer(t.TimerIds.Focus)}}},[t._v("Focus")]),e("div",{staticClass:"mode",class:{active:t.anyBreakTimerActive},attrs:{"data-test":"rest-btn"},on:{click:function(e){return t.clickTimer(t.TimerIds.Break)}}},[t._v("Break")])])]),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("three-col-layout",{key:t.activeTimerId,staticClass:"time-wrapper",scopedSlots:t._u([t.quickNavVisible?{key:"left",fn:function(){return[t.$touch?t._e():e("quick-nav",{attrs:{options:t.centerOptions,region:"center",active:"pomodoro"},on:{"switch-to":t.switchClock}})]},proxy:!0}:null,{key:"center",fn:function(){return[e("pomodoro-time",{directives:[{name:"mobile-click",rawName:"v-mobile-click",value:t.showToastMenu,expression:"showToastMenu"}],attrs:{"hide-seconds":t.hideSeconds,hours:t.hours,minutes:t.minutes,seconds:t.seconds},nativeOn:{dblclick:function(e){return t.showToastMenu.apply(null,arguments)}}})]},proxy:!0},{key:"right",fn:function(){return[e("pomodoro-dropdown",{attrs:{timers:t.timers,sounds:t.sounds,"browser-notifications":t.browserNotifications,autoplay:t.autoplay,"hide-seconds":t.hideSeconds,"completed-stats":t.completedStats,options:t.centerOptions},on:{"update:sounds":function(e){t.sounds=e},"update:browserNotifications":function(e){t.browserNotifications=e},"update:browser-notifications":function(e){t.browserNotifications=e},"update:autoplay":function(e){t.autoplay=e},"update:hideSeconds":function(e){t.hideSeconds=e},"update:hide-seconds":function(e){t.hideSeconds=e},"update:timer":t.setTimerDuration,"complete-timer":t.completeTimer,"restart-timer":t.restartTimer,"add-ten-minutes":t.addTenMinutes,"switch-clock":t.switchClock,ensureNotificationPermissions:t.ensureNotificationPermissions}})]},proxy:!0}],null,!0)})],1),e("div",{staticClass:"greeting-wrapper"},[e("transition",{attrs:{name:t.messageFade,mode:"out-in"}},[t.showFocusComponent?e("div",{staticClass:"greeting-inner-wrapper"},[e("focus",{staticClass:"center-focus",attrs:{"input-placeholder":"+ Add a focus","in-pomodoro":!0,"pomodoro-message":t.message}})],1):e("div",{key:t.message,staticClass:"greeting-inner-wrapper message",attrs:{"data-test":"message"}},[t._v(t._s(t.message))])]),e("div",{staticClass:"fix-height"},[t._v("Â ")])],1),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{key:t.activeTimerId,staticClass:"below"},[t.focusPlus10Visible?e("button",{staticClass:"button u--mobile-hide",attrs:{"data-test":"extend-focus-button"},on:{click:()=>t.extendFocusAfterEnd()}},[t._v("Focus +10 min")]):t._e(),e("button",{staticClass:"button",class:{disabled:0===t.timeRemaining},attrs:{"data-test":"start-stop-button"},on:{click:t.toggleMasterPlayPause}},[t._v(t._s(t.belowButtonText))])])])],1)}),[],!1,null,"0b4407d9").exports;export{x as default};