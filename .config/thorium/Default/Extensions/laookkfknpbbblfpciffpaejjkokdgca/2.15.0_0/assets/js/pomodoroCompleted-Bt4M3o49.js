import{d as e}from"./ResizeSensor-CXS_pGRc.js";import{f as t,u as s,k as r}from"./promisifiedChrome-CheD9WtZ.js";import{M as i}from"./timestampDb-sTUCijT1.js";import{u as a}from"./preload-helper-D7CfCCEq.js";import"./environmentVariables-Cy83xda0.js";import"./Logger-Dqn8sDPg.js";import"./string-KTo4Qfpe.js";class o{constructor(e){this.dataService=e}get(e){this.dataService.get(e)}create(e){return this.dataService.create(e.id,e)}}const n=e=>e.reduce(((e,t)=>e+Number(t.aggregatedEntries)),0),d=e=>e.reduce(((e,t)=>e+Number(t.focusMinutes)),0),u=(u=(()=>({pomodoroCompletedService:new o(new t("pomodoro",{path:"pomodoro/completed",mode:i.Timestamp,getResponseProperty:"completed",queryParams:{get:{cutoffDays:"7"}}}))}))().pomodoroCompletedService)=>e("pomodoroCompleted",{state:()=>({data:[],loading:!1,loaded:!1,currentSessionLength:0}),getters:{dataWithCurrentSessionIfActive(e){const t=[...e.data];return e.currentSessionLength>0&&t.push({id:a(),completed:(new Date).toISOString(),focusMinutes:e.currentSessionLength,aggregatedEntries:1}),t},completedStatsDaily(){return e=>{const t=Array(e+1).fill(void 0).map(((e,t)=>s.getDateStringDayOffset(-1*t))).map((e=>this.dataWithCurrentSessionIfActive.filter((t=>((e,t)=>e&&e.completed&&t.includes(s.getDateString(e.completed)))(t,[e])))));return{counts:t.map(n),focusedMinutes:t.map(d)}}},completedStats(){const e=this.completedStatsDaily(0),t=this.completedStatsDaily(m.models.date.get("hour").getDay());return{counts:{today:s.sumArray(e.counts),week:s.sumArray(t.counts),allTime:n(this.dataWithCurrentSessionIfActive)},focusedMinutes:{today:s.sumArray(e.focusedMinutes),week:s.sumArray(t.focusedMinutes),allTime:d(this.dataWithCurrentSessionIfActive)}}},allTimeMinutes(){return this.completedStats.focusedMinutes.allTime},weekMinutes(){return this.completedStats.focusedMinutes.week},todayMinutes(){return this.completedStats.focusedMinutes.today},pastDaysMinutes(){return e=>s.sumArray(this.completedStatsDaily(e).focusedMinutes)},allTime(){return r(60*this.allTimeMinutes*1e3)},week(){return r(60*this.weekMinutes*1e3)},today(){return r(60*this.todayMinutes*1e3)},completedCountSince(){return e=>this.dataWithCurrentSessionIfActive.filter((t=>new Date(t.completed).getTime()>e)).length},pastDays(){return e=>r(60*this.pastDaysMinutes(e)*1e3)}},actions:{refresh(){this.loaded||this.loading||(this.loading=!0,u.get({success:e=>{this.data=e||[],this.loaded=!0,this.loading=!1}}))},async create(e){this.data.push(e),e.id=s.uuidv4(),await u.create(e)}}}),c=u();export{c as default,u as makePomodoroCompletedStore,c as usePomodoroCompletedStore};