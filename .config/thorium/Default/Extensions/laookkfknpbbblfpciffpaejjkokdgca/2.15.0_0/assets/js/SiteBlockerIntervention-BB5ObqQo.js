const __vite__fileDeps=["assets/js/promisifiedChrome-CheD9WtZ.js","assets/js/timestampDb-sTUCijT1.js","assets/js/Logger-Dqn8sDPg.js","assets/js/environmentVariables-Cy83xda0.js","assets/js/ResizeSensor-CXS_pGRc.js","assets/js/preload-helper-D7CfCCEq.js","assets/js/string-KTo4Qfpe.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{a as e,r as t,b as s}from"./ResizeSensor-CXS_pGRc.js";import{_ as i}from"./preload-helper-D7CfCCEq.js";import{u as a}from"./internalDataMetrics-Dv3FrOgJ.js";import{n as r,j as o,F as n,p as l,c,f as d,b as u,A as h}from"./promisifiedChrome-CheD9WtZ.js";import{a as p}from"./string-KTo4Qfpe.js";import{A as v,g as b,I as f,a as g,s as k,D as w}from"./siteBlocker-BUnixiKK.js";import C from"./streaks-C8pfrYQP.js";import{S as _}from"./Streak-IKpO7W-4.js";import{c as S,a as y,S as I}from"./constants-D-OQQ8lR.js";import{P as x}from"./Popup-Xs5lohqh.js";import{F as R}from"./FlashMessage-BSLh5HLJ.js";import"./environmentVariables-Cy83xda0.js";import"./timestampDb-sTUCijT1.js";import"./Logger-Dqn8sDPg.js";import"./main--IJuvtTE.js";import"./AppPopup-D_ukOJBQ.js";import"./globalKeyEventManager-KbJZwtdf.js";import"./icon-close-BUGl_M7j.js";import"./chevron-down-DdbU9YAr.js";const M=r(e({name:"SiteBlockerInterventionResistanceStreak",setup:()=>({internalDataMetrics:a()}),computed:{sitesResistedStreakMetric(){return this.internalDataMetrics.getMetric("streaksStats","getSitesResistedStreak")},sitesResistedStreak(){var e,t;return this.sitesResistedStreakMetric.value.storeLoaded?(null==(t=(e=this.sitesResistedStreakMetric.value).getterValue)?void 0:t.call(e))||0:"-"}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-resistance-streak metric-type app-dash"},[t("div",{staticClass:"metric-stat"},[t("span",{attrs:{"data-test":"resistance-streak"}},[e._v(e._s(e.sitesResistedStreak))])]),e._m(0)])}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"metric-label"},[t("span",{staticClass:"metric-label-name"},[e._v("Resistance streak")])])}],!1,null,"035e5669").exports;const H=r(e({name:"SiteBlockerInterventionAffirmation",setup:()=>({affirmation:p(v)})}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-affirmation"},[e._v(" "+e._s(e.affirmation)+" ")])}),[],!1,null,"91e3e7ce").exports;const j=r(e({name:"SiteBlockerInterventionBypassBreath",emits:["complete"],data:()=>({text:"inhale",shrinking:!0}),async mounted(){await o(700),this.shrinking=!1,await o(3750),this.text="",await o(800),this.text="exhale",await o(600),this.shrinking=!0,await o(3750),this.text="",await o(1500),this.$emit("complete")}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-bypass-breath"},[t("div",{staticClass:"breath-title"},[e._v("Take a deep breath")]),t("div",{staticClass:"breath-content",class:{shrinking:e.shrinking}},[t("div",{staticClass:"circle"}),t("div",{staticClass:"circle"}),t("div",{staticClass:"circle"}),t("transition",{attrs:{name:"fade",mode:"out-in",duration:500}},[t("div",{key:e.text,staticClass:"text"},[e._v(e._s(e.text))])])],1)])}),[],!1,null,"d9b67639").exports,B=new h({feature:"site blocker"}),P=e({name:"SiteBlockerInterventionDashboard",components:{SiteBlockerInterventionResistanceStreak:M,SiteBlockerInterventionAffirmation:H,SiteBlockerInterventionBypassBreath:j,Popup:x,FlashMessage:R},setup(){const e=new URL(location.href).searchParams;return{center:t(),topLeft:t(),searchParams:e,siteName:b(decodeURIComponent(e.get("sitename")||""),decodeURIComponent(e.get("metatitle")||""),decodeURIComponent(e.get("documenttitle")||""),decodeURIComponent(e.get("hostname")||"")),streaksStore:C(),lastFocus:localStorage.getItem(S),shouldShowFlashMessage:"true"===e.get("bypassDelayOver"),tabWasMuted:!1,tabId:null,isChromium:n()}},data:()=>({topRowHeight:0,centerAboveHeight:0,bypassing:!1,dashboardVisible:!0,streakTipVisible:"true"!==localStorage.getItem(f)}),computed:{topRowHeightPx(){return this.topRowHeight+"px"},centerAboveHeightPx(){return this.centerAboveHeight+"px"}},async mounted(){var e;if(this.shouldShowFlashMessage){const e=(await i((()=>import("./promisifiedChrome-CheD9WtZ.js").then((e=>e.K))),__vite__mapDeps([0,1,2,3,4,5,6]))).default;await this.$nextTick(),e.$emit("flashMessage",{message:"It's been 5 minutes. Focus on what matters.",persist:5e3})}if(m.trigger("globalEvent:window:resize"),!this.isChromium)return;const t=await l.tabs.getCurrent();(null==t?void 0:t.id)&&(this.tabId=t.id,(null==(e=null==t?void 0:t.mutedInfo)?void 0:e.muted)?this.tabWasMuted=!0:(await l.tabs.update(this.tabId,{muted:!0}),window.addEventListener("beforeunload",this.unmuteTabBeforeUnload)),this.unregisterTabCloseInServiceWorker(),window.addEventListener("beforeunload",this.registerTabCloseInServiceWorker)),window.addEventListener("storage",(e=>{(e.key===y&&!g()||e.key===I&&"false"===e.newValue)&&(this.dashboardVisible=!1)}))},methods:{calculateGridRowHeights(){var e,t,s;((null==(e=this.center)?void 0:e.offsetHeight)??0)<0||(this.topRowHeight=(null==(t=this.topLeft)?void 0:t.offsetHeight)??0,this.centerAboveHeight=window.innerHeight/2-(((null==(s=this.center)?void 0:s.offsetHeight)??0)/2+this.topRowHeight))},startBypassing(){this.bypassing=!0,B.capture("intervention start tab bypass")},async close(){if(B.capture("intervention close tab",{currently_bypassing:this.bypassing}),!this.isChromium)return;const e=await c().tabs.getCurrent();(null==e?void 0:e.id)&&await c().tabs.remove(e.id)},async dismiss(){this.isChromium&&await this.streaksStore.create({subset:_.SitesResisted,timestamp:Date.now(),valid:!1,data:this.searchParams.get("hostname")||""}),this.dashboardVisible=!1},async openMomentum(e){await this.increaseStreak(),window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),B.capture("intervention open momentum",{from:e}),this.isChromium?c().tabs.update({url:"/dashboard.html"}):window.parent.location.href=window.location.origin+"/dashboard.html"},async increaseStreak(){this.isChromium&&await this.streaksStore.create({subset:_.SitesResisted,timestamp:Date.now(),valid:!0})},async afterLeave(){if(this.tabId&&(this.tabWasMuted||(await l.tabs.update(this.tabId,{muted:!1}),window.removeEventListener("beforeunload",this.unmuteTabBeforeUnload))),this.bypassing){B.capture("intervention tab bypassed");const e=g();e&&k(e)}window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),window.parent.postMessage(w,"*"),location.reload()},dismissStreakTip(){this.streakTipVisible=!1,localStorage.setItem(f,"true")},unmuteTabBeforeUnload(){this.tabId&&l.tabs.update(this.tabId,{muted:!1})},registerTabCloseInServiceWorker(){if(!this.tabId)return;if(!this.isChromium)return;const e=new d("");u.sendMessage({handler:"increaseStreakWhenTabClosed",args:[this.tabId,this.searchParams.get("hostname")||"",e.getEnv()]})},unregisterTabCloseInServiceWorker(){this.tabId&&this.isChromium&&u.sendMessage({handler:"removeStreakTabClosedListener",args:[this.tabId]})}}}),T=()=>{s(((e,t)=>({a65e8d92:e.topRowHeightPx,"5b47d0d8":e.centerAboveHeightPx})))},L=P.setup;P.setup=L?(e,t)=>(T(),L(e,t)):T;const F=r(e({name:"SiteBlockerIntervention",components:{SiteBlockerInterventionDashboard:r(P,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("transition",{attrs:{name:"fade-fast"},on:{"after-leave":e.afterLeave}},[e.dashboardVisible?t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"site-blocker-intervention-dashboard dashboard dark dark-full"},[t("div",{staticClass:"top-row"},[t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"topLeft",staticClass:"top-left"},[t("div",{staticClass:"dash-button dash-button-neutral open-momentum",on:{click:function(t){return e.openMomentum("button")}}},[e._v("Open Momentum")])]),t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"top-right"},[e.isChromium?t("site-blocker-intervention-resistance-streak"):e._e()],1)]),t("div",{staticClass:"center-above"}),t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"center",staticClass:"center"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.bypassing?t("site-blocker-intervention-bypass-breath",{staticClass:"center-content",on:{complete:e.dismiss}}):t("div",{staticClass:"center-content"},[t("div",{staticClass:"site-blocked"},[e._v("Site blocked"),e.lastFocus?t("span",[e._v(" • Focusing on")]):e._e()]),t("div",{staticClass:"current-focus",attrs:{"data-test":"current-focus"},on:{click:function(t){return e.openMomentum(e.lastFocus?"focus":"emptyFocus")}}},[e._v(e._s(e.lastFocus||"Focusing"))])])],1)],1),t("div",{staticClass:"center-below"},[t("div",{staticClass:"buttons",class:{"shortcut-help":!e.isChromium}},[e.isChromium?t("div",{staticClass:"dash-button close-tab",on:{click:e.close}},[e._v("Close tab")]):t("div",{staticClass:"dash-button close-tab no-pointer-events",on:{click:e.close}},[e._v("Press ⌘ W to close tab")]),t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.bypassing?e.isChromium?t("div",{key:"2",staticClass:"dash-button open-site no-pointer-events"},[e._v("By continuing you will break your resistance streak")]):e._e():t("div",{key:"1",staticClass:"dash-button open-site",on:{click:e.startBypassing}},[e._v("Open "+e._s(e.siteName))])])],1)]),t("div",{staticClass:"bottom-row"},[t("div",{staticClass:"bottom-center"},[t("site-blocker-intervention-affirmation")],1)]),t("transition",{attrs:{name:"fade-blurred-tip-app",appear:""}},[e.streakTipVisible&&e.dashboardVisible&&e.isChromium?t("popup",{attrs:{id:"intervention-streak-tooltip","target-element-selector":".site-blocker-intervention-resistance-streak",position:"left-bottom","body-text":"Your streak resets if you open this website.",width:225,"nipple-displacement":25,"target-distance":10},on:{dismiss:e.dismissStreakTip}}):e._e()],1),e.shouldShowFlashMessage?t("flash-message"):e._e()],1):e._e()])}),[],!1,null,"5c89b1e4").exports}}),(function(){var e=this._self._c;return this._self._setupProxy,e("div",{staticClass:"site-blocker-intervention"},[e("site-blocker-intervention-dashboard")],1)}),[],!1,null,null).exports;export{F as default};