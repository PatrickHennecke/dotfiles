import{a as e,r as t,b as s}from"./ResizeSensor-CXS_pGRc.js";import{A as a,n as i,u as r,a as n,T as o}from"./promisifiedChrome-CheD9WtZ.js";import{_ as l}from"./icon-error-state-BKQhfBCj.js";import{a as d}from"./authService-B5VliZ3K.js";import{B as c,T as u}from"./PlusBenefits-BpoeVvVL.js";import{_ as f}from"./close-D7GCNZxm.js";import"./environmentVariables-Cy83xda0.js";import"./timestampDb-sTUCijT1.js";import"./Logger-Dqn8sDPg.js";import"./preload-helper-D7CfCCEq.js";import"./string-KTo4Qfpe.js";import"./dashboard-CF_jRhAY.js";import"./main--IJuvtTE.js";import"./localStorage-B4mFdj8F.js";import"./migrateLegacyUserMessageHandler-CU6TUnqH.js";import"./reactiveCustomization-CrL2eTrh.js";import"./VueBase-CjPGMLuv.js";import"./index-CJJH83pl.js";import"./SubscriptionSummary-Bb_CwKvU.js";import"./star-KworSO8x.js";import"./icon-back-D_TFrgyJ.js";const p="momentum:iframe:otp:request",g="momentum:iframe:unregistered:refresh",h="momentum:iframe:posthog:error",v=e({name:"IframeHost",props:{messenger:{type:Object,required:!0},startingHeight:{type:String,default:"100%"},fallbackUrl:{type:String,default:""},fallbackTimeoutDelay:{type:Number,default:5e3}},setup:()=>({iframe:t()}),data(){return{height:this.startingHeight,iframeOffline:!1}},computed:{ready(){return this.messenger.connected}},mounted(){this.messenger.addMessageListener("momentum:iframe:height:resize",this.updateIframeHeight),setTimeout((()=>{this.messenger.connected||this.setIframeOffline()}),this.fallbackTimeoutDelay)},methods:{async onIframeLoad(){if(!this.iframe)return this.setIframeOffline();await this.messenger.connect(this.iframe)},updateIframeHeight({height:e}){this.height=e??this.startingHeight},setIframeOffline(){this.iframeOffline=!0},captureFallbackClick(){a.capture("iframe fallback click",{feature:this.messenger.id})}}}),y=()=>{s(((e,t)=>({"705cdd08":e.height})))},b=v.setup;v.setup=b?(e,t)=>(y(),b(e,t)):y;const _=i(v,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"iframe-host"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.iframeOffline?t("div",{key:"offline",staticClass:"iframe-offline"},[e._t("offline",(function(){return[t("inline-svg",{staticClass:"icon icon-error",attrs:{src:l}}),t("p",[e._v("Oops! Looks like something went wrong."),t("br"),e._v("Please continue on our website.")]),e.fallbackUrl?t("a",{staticClass:"button",attrs:{href:e.fallbackUrl,"data-test":"fallback-button",target:"_blank"},on:{click:e.captureFallbackClick}},[e._v(" Continue ")]):e._e()]}))],2):t("iframe",{key:"iframe",ref:"iframe",staticClass:"iframe-frame",attrs:{src:e.messenger.url,"data-test-loaded":e.ready},on:{load:e.onIframeLoad}})])],1)}),[],!1,null,"66902d35").exports;class M{constructor(e,t){this.id=(null==t?void 0:t.id)??e,this.events=(null==t?void 0:t.events)??{},this.url=r.extendUrlParams(`${m.globals.urlRootMarketing}ext/${e}`,{...(null==t?void 0:t.params)??{},frameId:this.id}),this.connected=!1}async onMessage(e){var t,s;const{type:a,id:i,data:r}=e.data;if(!a||!r||i!==this.id)return;const n=await(null==(s=(t=this.events)[a])?void 0:s.call(t,r,this))??{};this.sendMessage(a+":response",n)}async connect(e){return this.iframe=e,window.addEventListener("message",(e=>{this.onMessage(e)})),await this.sendMessageAndGetResponse("momentum:iframe:connect",{targetUrl:encodeURI(window.origin)}),this.connected=!0}disconnect(){window.removeEventListener("message",(e=>{this.onMessage(e)})),this.connected=!1}sendMessage(e,t){var s,a;null==(a=null==(s=this.iframe)?void 0:s.contentWindow)||a.postMessage({type:e,id:this.id,data:t??{}},m.globals.urlRootMarketing)}addMessageListener(e,t){this.events[e]=t}removeMessageListener(e){delete this.events[e]}addOneTimeAsyncResponseMessageListener(e){return new Promise((t=>{const s=e+":response";this.addMessageListener(s,(e=>{this.removeMessageListener(s),t(e)}))}))}sendMessageAndGetResponse(e,t){return this.sendMessage(e,t),this.addOneTimeAsyncResponseMessageListener(e)}}const k={userUuid:r.getUserUuid()??""},j={[p]:async()=>{if(!r.getUserUuid())return;const{otp:e}=await d.generateOneTimePassword();return{otp:e}},[g]:async()=>{var e;const{data:t}=await n.get("/user/profile?details=1");localStorage.setItem("email",(null==(e=t.emails[0])?void 0:e.email)??""),localStorage.removeItem("unregistered"),localStorage.removeItem("registrationStatePending")}},C=new o("tab.iframe",.1),w={[h]:({event:e},t)=>{C.error(e,{feature:t.id})}};const L=i(e({name:"UpgradeModalIframe",components:{IframeHost:_},props:{feature:{type:String,required:!0},startingHeight:{type:String,required:!0}},emits:["complete"],setup:e=>({messenger:new M(e.feature,{params:k,events:{...j,...w}})}),mounted(){this.messenger.addMessageListener("complete",(()=>{this.$emit("complete")}))},destroyed(){this.messenger.disconnect()}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("iframe-host",{attrs:{messenger:e.messenger,"data-test":"upgrade-modal-iframe","starting-height":e.startingHeight,"fallback-url":`https://momentumdash.com/setup/plus/${e.feature}`}})}),[],!1,null,null).exports,U=e({name:"PlusBenefits",components:{BenefitList:c}});const I=e({name:"UpgradeModalLayout",components:{Testimonials:u,PlusBenefits:i(U,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"plus-benefits"},[t("div",{staticClass:"heading"},[e._v("Get the most out of Momentum")]),t("benefit-list")],1)}),[],!1,null,"9f2ad373").exports},emits:["dismiss"],methods:{dismissModal(){this.$emit("dismiss")}}});const S=i(e({name:"UpgradeModal",components:{UpgradeModalIframe:L,UpgradeModalLayout:i(I,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"upgrade-modal-layout dark"},[t("div",{staticClass:"details-content"},[t("plus-benefits"),t("testimonials",{attrs:{"stars-visible":!0}})],1),t("div",{staticClass:"iframe-content app reset-app-styles light light-full"},[t("div",{staticClass:"icon-wrapper",attrs:{"data-test":"upgrade-modal-close"},on:{click:e.dismissModal}},[t("inline-svg",{staticClass:"icon icon-close",attrs:{src:f}})],1),e._t("default")],2)])}),[],!1,null,"fc942b7c").exports},props:{feature:{type:String,required:!0},startingHeight:{type:String,required:!0}},emits:["dismiss","stepComplete"]}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("upgrade-modal-layout",{staticClass:"upgrade-modal",attrs:{"data-test":"upgrade-modal"},on:{dismiss:function(t){return e.$emit("dismiss")}}},[t("upgrade-modal-iframe",{staticClass:"upgrade-modal-iframe",attrs:{feature:e.feature,"starting-height":e.startingHeight},on:{complete:function(t){return e.$emit("stepComplete")}}})],1)}),[],!1,null,"9217a4d8").exports;export{S as default};